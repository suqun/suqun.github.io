<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[å…¥è€³ç®¸å¿ƒ]]></title>
  <subtitle><![CDATA[æˆé•¿è·¯ä¸Šçš„ç‚¹æ»´è®°å½•]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://suqun.github.io/"/>
  <updated>2017-02-18T13:54:09.000Z</updated>
  <id>http://suqun.github.io/</id>
  
  <author>
    <name><![CDATA[Larry]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[JVMç¬”è®°äº”ï¼šåƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥â€”â€”åƒåœ¾æ”¶é›†ç®—æ³•]]></title>
    <link href="http://suqun.github.io/2017/02/18/JVM-note-5/"/>
    <id>http://suqun.github.io/2017/02/18/JVM-note-5/</id>
    <published>2017-02-18T13:11:15.000Z</published>
    <updated>2017-02-18T13:54:09.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u6807_u8BB0-_u6E05_u9664_u7B97_u6CD5"><a href="#u6807_u8BB0-_u6E05_u9664_u7B97_u6CD5" class="headerlink" title="æ ‡è®°-æ¸…é™¤ç®—æ³•"></a>æ ‡è®°-æ¸…é™¤ç®—æ³•</h3><p>æœ€åŸºç¡€çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/jvm-mark-sweep-1.png" alt=""></p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/jvm-mark-sweep.png" alt=""></p>
<p>å‚è€ƒï¼š<a href="http://www.jianshu.com/p/b0f5d21fe031" target="_blank" rel="external">http://www.jianshu.com/p/b0f5d21fe031</a></p>
<h3 id="u590D_u5236_u7B97_u6CD5"><a href="#u590D_u5236_u7B97_u6CD5" class="headerlink" title="å¤åˆ¶ç®—æ³•"></a>å¤åˆ¶ç®—æ³•</h3><p>åŠåŒºå¤åˆ¶ç®—æ³•çš„ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†æ›´å¥½çš„ç¼“è§£å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/jvm-copying-1.png" alt=""></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u6807_u8BB0-_u6E05_u9664_u7B97_u6CD5"><a href="#u6807_u8BB0-_u6E05_u9664_u7B97_u6CD5" class="headerlink" title="æ ‡è®°-æ¸…é™¤ç®—æ³•"></a>æ ‡è®°-æ¸…é™¤ç®—æ³•]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[JVMç¬”è®°å››ï¼šåƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥â€”â€”å¯¹è±¡]]></title>
    <link href="http://suqun.github.io/2017/02/18/JVM-note-4/"/>
    <id>http://suqun.github.io/2017/02/18/JVM-note-4/</id>
    <published>2017-02-18T02:27:59.000Z</published>
    <updated>2017-02-18T13:13:31.000Z</updated>
    <content type="html"><![CDATA[<p>åœ¨å †é‡Œå­˜æ”¾ç€Javaä¸–ç•Œä¸­å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨å¯¹å †è¿›è¡Œå›æ”¶å‰ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¦ç¡®å®šè¿™äº›å¯¹è±¡ä¹‹ä¸­å“ªäº›è¿˜å­˜æ´»ç€ï¼Œå“ªäº›å·²ç»æ­»å»ï¼ˆå³ä¸å¯èƒ½å†è¢«ä»»ä½•é€”å¾„ä½¿ç”¨çš„å¯¹è±¡ï¼‰ã€‚</p>
<h3 id="u5F15_u7528_u8BA1_u6570_u6CD5"><a href="#u5F15_u7528_u8BA1_u6570_u6CD5" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h3><p>å¼•ç”¨è®¡æ•°æ³•ï¼ˆReference Countingï¼‰ï¼šç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å°±åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å°±å‡1ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡æ˜¯ä¸å¯èƒ½è¢«ä½¿ç”¨çš„ã€‚ä¸»æµçš„Javaè™šæ‹Ÿæœºé‡Œæ²¡æœ‰ä½¿ç”¨å¼•ç”¨è®¡æ•°æ³•æ¥ç®¡ç†å†…å­˜ï¼Œä¸»è¦åŸå› æ˜¯å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * å¼•ç”¨è®¡æ•°å™¨ç®—æ³•çš„ç¼ºé™·</span><br><span class="line"> * VM Argsï¼š-XX:+PrintGCDetails</span><br><span class="line"> * JDK1.6</span><br><span class="line"> * Created by larry.su on 2017/2/18.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReferenceCountingGC</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Object instance = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _1M = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¸ªæˆå‘˜å±æ€§çš„å”¯ä¸€æ„ä¹‰å°±æ˜¯å ç”¨ç‚¹å†…å­˜ï¼Œä»¥ä¾¿èƒ½åœ¨GCä¸­çœ‹æ¸…æ¥šæ˜¯å¦è¢«å›æ”¶è¿‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] bigSize = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2</span> * _1M];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ReferenceCountingGC objA = <span class="keyword">new</span> ReferenceCountingGC();</span><br><span class="line">        ReferenceCountingGC objB = <span class="keyword">new</span> ReferenceCountingGC();</span><br><span class="line"></span><br><span class="line">        objA.instance = objB;</span><br><span class="line">        objB.instance = objA;</span><br><span class="line"></span><br><span class="line">        objA = <span class="keyword">null</span>;</span><br><span class="line">        objB = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‡è®¾æ­¤æ—¶å‘ç”ŸGCï¼ŒobjAå’ŒobjBæ˜¯å¦ä¼šè¢«å›æ”¶</span></span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(System)</span> [CMS: 0K-&gt;423<span class="title">K</span><span class="params">(<span class="number">63872</span>K)</span>, 0.0099285 secs] **6167K-&gt;423K**<span class="params">(<span class="number">83008</span>K)</span>, [CMS Perm : 4749K-&gt;4747<span class="title">K</span><span class="params">(<span class="number">21248</span>K)</span>], 0.0107293 secs] [Times: user</span>=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> par <span class="keyword">new</span> generation   total <span class="number">19136</span>K, used <span class="number">1021</span>K [<span class="number">7f</span>3000000, <span class="number">7f</span>44c0000, <span class="number">7f</span>44c0000)</span><br><span class="line">  eden space <span class="number">17024</span>K,   <span class="number">6</span>% used [<span class="number">7f</span>3000000, <span class="number">7f</span>30ff670, <span class="number">7f</span>40a0000)</span><br><span class="line">  from space <span class="number">2112</span>K,   <span class="number">0</span>% used [<span class="number">7f</span>40a0000, <span class="number">7f</span>40a0000, <span class="number">7f</span>42b0000)</span><br><span class="line">  to   space <span class="number">2112</span>K,   <span class="number">0</span>% used [<span class="number">7f</span>42b0000, <span class="number">7f</span>42b0000, <span class="number">7f</span>44c0000)</span><br><span class="line"> concurrent mark-sweep generation total <span class="number">63872</span>K, used <span class="number">423</span>K [<span class="number">7f</span>44c0000, <span class="number">7f</span>8320000, <span class="number">7f</span>ae00000)</span><br><span class="line"> concurrent-mark-sweep perm gen total <span class="number">21248</span>K, used <span class="number">4880</span>K [<span class="number">7f</span>ae00000, <span class="number">7f</span>c2c0000, <span class="number">800000000</span>)</span><br></pre></td></tr></table></figure>
<p><strong>6167K-&gt;423K(83008K)</strong>æ„å‘³ç€è™šæ‹Ÿæœºå¹¶æ²¡æœ‰å› ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡å¹¶ç›¸äº’å¼•ç”¨å°±ä¸å›æ”¶ä»–ä»¬ï¼Œä¹Ÿä»ä¾§é¢è¯´æ˜è™šæ‹Ÿæœºå¹¶ä¸æ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„ã€‚</p>
<h3 id="u53EF_u8FBE_u6027_u5206_u6790_u7B97_u6CD5"><a href="#u53EF_u8FBE_u6027_u5206_u6790_u7B97_u6CD5" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h3><p><img src="http://7xpk5e.com1.z0.glb.clouddn.com//jvm-reachabilityAnalysis.png" alt="å¯è¾¾æ€§åˆ†æç®—æ³•"></p>
<h3 id="u518D_u8C08_u5F15_u7528"><a href="#u518D_u8C08_u5F15_u7528" class="headerlink" title="å†è°ˆå¼•ç”¨"></a>å†è°ˆå¼•ç”¨</h3><p>åœ¨JDK1.2ä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œåˆ†ä¸ºå¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰ã€è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰ã€å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰ã€è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰4ç§ï¼Œè¿™4ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com//jvm-reference.png" alt="reference"></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>åœ¨å †é‡Œå­˜æ”¾ç€Javaä¸–ç•Œä¸­å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨å¯¹å †è¿›è¡Œå›æ”¶å‰ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¦ç¡®å®šè¿™äº›å¯¹è±¡ä¹‹ä¸­å“ªäº›è¿˜å­˜æ´»ç€ï¼Œå“ªäº›å·²ç»æ­»å»ï¼ˆå³ä¸å¯èƒ½å†è¢«ä»»ä½•é€”å¾„ä½¿ç”¨çš„å¯¹è±¡ï¼‰ã€‚</p>
<h3 id="u5F15_u7528_u8BA1_u6570_u6CD5"><a href="]]>
    </summary>
    
      <category term="JVM" scheme="http://suqun.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[JVMç¬”è®°ä¸‰ï¼šJavaå†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸â€”â€”OutOfMemoryErrorå¼‚å¸¸]]></title>
    <link href="http://suqun.github.io/2017/02/16/JVM-note-3/"/>
    <id>http://suqun.github.io/2017/02/16/JVM-note-3/</id>
    <published>2017-02-16T13:35:09.000Z</published>
    <updated>2017-02-18T13:13:32.000Z</updated>
    <content type="html"><![CDATA[<h2 id="Java_u5806_u6EA2_u51FA"><a href="#Java_u5806_u6EA2_u51FA" class="headerlink" title="Javaå †æº¢å‡º"></a>Javaå †æº¢å‡º</h2><p>Javaå †ç”¨äºå­˜å‚¨å¯¹è±¡å®ä¾‹ï¼Œåªè¦ä¸æ–­åœ°åˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¸”ä¿è¯GC Rootsåˆ°å¯¹è±¡ä¹‹é—´æœ‰å¯è¾¾è·¯å¾„æ¥é¿å…åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤è¿™äº›å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨å¯¹è±¡æ•°é‡åˆ°è¾¾æœ€å¤§çš„å®¹é‡é™åˆ¶åå°±ä¼šäº§ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚</p>
<p>ä¸‹é¢ä»£ç é™åˆ¶Javaå †çš„å¤§å°ä¸º20MBï¼Œä¸å¯æ‰©å±•ï¼ˆå°†å †çš„æœ€å°å€¼-Xmså‚æ•°ä¸æœ€å¤§å€¼-Xmxå‚æ•°è®¾ç½®ä¸ºä¸€æ ·å³å¯é¿å…å †è‡ªåŠ¨æ‰©å±•ï¼‰ï¼Œé€šè¿‡å‚æ•°-XX:+HeapDumpOnOutOfMemoryErrorå¯ä»¥è®©è™šæ‹Ÿæœºåœ¨å‡ºç°å†…å­˜æº¢å‡ºæ—¶Dumpå‡ºå½“å‰çš„å†…å­˜å †è½¬å‚¨å¿«ç…§ä»¥ä¾¿äº‹åè¿›è¡Œåˆ†æã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * HeapOOM</span><br><span class="line"> * Created by larry.su on 2017/2/7.</span><br><span class="line"> * -Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapOOM</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OOMObject</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;OOMObject&gt; list = <span class="keyword">new</span> ArrayList&lt;OOMObject&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> OOMObject());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">Dumping heap to java_pid65766.hprof ...</span><br><span class="line">Heap dump file created [<span class="number">27784157</span> bytes in <span class="number">0.137</span> secs]</span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: Java heap space</span><br></pre></td></tr></table></figure>
<h3 id="u865A_u62DF_u673A_u6808_u548C_u672C_u5730_u65B9_u6CD5_u6808_u6EA2_u51FA"><a href="#u865A_u62DF_u673A_u6808_u548C_u672C_u5730_u65B9_u6CD5_u6808_u6EA2_u51FA" class="headerlink" title="è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º"></a>è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º</h3><p>HotSpotè™šæ‹Ÿæœºä¸­å¹¶ä¸åŒºåˆ†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œå¯¹äºHotSpotæ¥è¯´ï¼Œè™½ç„¶-Xosså‚æ•°ï¼ˆè®¾ç½®æœ¬åœ°æ–¹æ³•æ ˆå¤§å°ï¼‰å­˜åœ¨ï¼Œä½†å®é™…ä¸Šæ˜¯æ— æ•ˆçš„ã€‚æ ˆå®¹é‡åªç”±-Xsså‚æ•°è®¾å®šã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * VM Args: -Xss160k</span><br><span class="line"> * Created by larry.su on 2017/2/17.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaVMStackSOF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> stackLength = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stackLeak</span><span class="params">()</span></span>&#123;</span><br><span class="line">        stackLength ++ ;</span><br><span class="line">        stackLeak();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        JavaVMStackSOF oom = <span class="keyword">new</span> JavaVMStackSOF();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            oom.stackLeak();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"stackLength:"</span> + oom.stackLength);</span><br><span class="line">            <span class="keyword">throw</span>  e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.lang.StackOverflowError</span><br><span class="line">stackLength:<span class="number">744</span></span><br><span class="line">    at com.jvm.JavaVMStackSOF.stackLeak(JavaVMStackSOF.java:<span class="number">14</span>)</span><br><span class="line">    at com.jvm.JavaVMStackSOF.stackLeak(JavaVMStackSOF.java:<span class="number">15</span>)</span><br><span class="line">    at com.jvm.JavaVMStackSOF.stackLeak(JavaVMStackSOF.java:<span class="number">15</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨å•çº¿ç¨‹ä¸‹ï¼Œæ— è®ºæ˜¯ç”±äºæ ˆå¸§å¤ªå¤§è¿˜æ˜¯è™šæ‹Ÿæœºæ ˆå¸§å®¹é‡å¤ªå°ï¼Œå½“å†…å­˜æ— æ³•åˆ†é…çš„æ—¶å€™ï¼Œè™šæ‹ŸæœºæŠ›å‡ºçš„éƒ½æ˜¯StackOverFlowErrorå¼‚å¸¸ã€‚</p>
<h3 id="u65B9_u6CD5_u533A_u548C_u8FD0_u884C_u65F6_u5E38_u91CF_u6C60_u6EA2_u51FA"><a href="#u65B9_u6CD5_u533A_u548C_u8FD0_u884C_u65F6_u5E38_u91CF_u6C60_u6EA2_u51FA" class="headerlink" title="æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º"></a>æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º</h3><p>ç”±äºè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤è¿™ä¸¤ä¸ªåŒºåŸŸçš„æº¢å‡ºæµ‹è¯•å°±æ”¾åœ¨ä¸€èµ·è¿›è¡Œã€‚<strong>æ–¹æ³•åŒºç”¨äºå­˜æ”¾Classçš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç±»åã€è®¿é—®ä¿®é¥°ç¬¦ã€å¸¸é‡æ± ã€å­—æ®µæè¿°ã€æ–¹æ³•æè¿°ç­‰ã€‚</strong></p>
<p><code>String.intern()</code>ã€‚åœ¨JDK1.6ä¹‹å‰ç‰ˆæœ¬ä¸­ç”±äºå¸¸é‡æ± åˆ†é…åœ¨æ°¸ä¹…å†…å­˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡-XX:PermSizeå’Œ-XX:MaxPermSizeé™åˆ¶æ–¹æ³•åŒºçš„å¤§å°ï¼Œä»è€Œé—´æ¥é™åˆ¶å…¶ä¸­å¸¸é‡æ± çš„å®¹é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Returns a canonical representation for the string object.</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * A pool of strings, initially empty, is maintained privately by the</span><br><span class="line"> * class &#123;<span class="doctag">@code</span> String&#125;.</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * When the intern method is invoked, if the pool already contains a</span><br><span class="line"> * string equal to this &#123;<span class="doctag">@code</span> String&#125; object as determined by</span><br><span class="line"> * the &#123;<span class="doctag">@link</span> #equals(Object)&#125; method, then the string from the pool is</span><br><span class="line"> * returned. Otherwise, this &#123;<span class="doctag">@code</span> String&#125; object is added to the</span><br><span class="line"> * pool and a reference to this &#123;<span class="doctag">@code</span> String&#125; object is returned.</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * It follows that for any two strings &#123;<span class="doctag">@code</span> s&#125; and &#123;<span class="doctag">@code</span> t&#125;,</span><br><span class="line"> * &#123;<span class="doctag">@code</span> s.intern() == t.intern()&#125; is &#123;<span class="doctag">@code</span> true&#125;</span><br><span class="line"> * if and only if &#123;<span class="doctag">@code</span> s.equals(t)&#125; is &#123;<span class="doctag">@code</span> true&#125;.</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * All literal strings and string-valued constant expressions are</span><br><span class="line"> * interned. String literals are defined in section 3.10.5 of the</span><br><span class="line"> * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;.</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@return</span>  a string that has the same contents as this string, but is</span><br><span class="line"> *          guaranteed to be from a pool of unique strings.</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">intern</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * VM Args: -XX:PermSize=10M -XX:MaxPermSize=10M</span><br><span class="line"> * Created by larry.su on 2017/2/17.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RuntimeConstantsPoolOOM</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨Listä¿æŒå¸¸é‡æ± çš„å¼•ç”¨ï¼Œé¿å…Full GCå›æ”¶å¸¸é‡æ± è¡Œä¸º</span></span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="comment">//10M çš„PermSizeåœ¨IntegerèŒƒå›´å†…è¶³å¤Ÿäº§ç”ŸOOM</span></span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                list.add(String.valueOf(i++).intern());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                System.out.println(i);</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">86889</span></span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: PermGen space</span><br><span class="line">at java.lang.String.intern(Native Method)</span><br><span class="line">at com.jvm.RuntimeConstantsPoolOOM.main(RuntimeConstantsPoolOOM.java:<span class="number">21</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨JDK1.7ä¸­è¿è¡Œè¿™æ®µä»£ç å°±ä¸ä¼šå¾—åˆ°ç›¸åŒçš„æ¥å£ï¼Œwhileä¼šä¸€ç›´å¾ªç¯ä¸‹å»ã€‚</p>
<p>åœ¨JDK8ä¸­ï¼ŒwhileåŒæ ·ä¸€ç›´å¾ªç¯ä¸‹å»ï¼ŒåŒæ—¶æ§åˆ¶å°æ‰“å°å¦‚ä¸‹ä¿¡æ¯ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Java <span class="title">HotSpot</span><span class="params">(TM)</span> 64-Bit Server VM warning: ignoring option PermSize</span>=<span class="number">10</span>M; support was removed in <span class="number">8.0</span></span><br><span class="line"><span class="function">Java <span class="title">HotSpot</span><span class="params">(TM)</span> 64-Bit Server VM warning: ignoring option MaxPermSize</span>=<span class="number">10</span>M; support was removed in <span class="number">8.0</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="Java_u5806_u6EA2_u51FA"><a href="#Java_u5806_u6EA2_u51FA" class="headerlink" title="Javaå †æº¢å‡º"></a>Javaå †æº¢å‡º</h2><p>Javaå †ç”¨äºå­˜å‚¨å¯¹è±¡å®ä¾‹ï¼Œåªè¦ä¸æ–­åœ°åˆ›]]>
    </summary>
    
      <category term="JVM" scheme="http://suqun.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[JVMç¬”è®°äºŒï¼šJavaå†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸â€”â€”HotSpotè™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜]]></title>
    <link href="http://suqun.github.io/2017/02/14/JVM-note-2/"/>
    <id>http://suqun.github.io/2017/02/14/JVM-note-2/</id>
    <published>2017-02-14T12:42:05.000Z</published>
    <updated>2017-02-18T13:13:23.000Z</updated>
    <content type="html"><![CDATA[<p>ä»¥å¸¸ç”¨çš„è™šæ‹ŸæœºHotSpotå’Œå¸¸ç”¨çš„å†…å­˜åŒºåŸŸJavaå †ä¸ºä¾‹ï¼Œæ·±å…¥æ¢è®¨HotSpotè™šæ‹Ÿæœºåœ¨Javaå †ä¸­å¯¹è±¡åˆ†é…ã€å¸ƒå±€å’Œè®¿é—®çš„å…¨è¿‡ç¨‹ã€‚</p>
<h3 id="u5BF9_u8C61_u7684_u521B_u5EFA"><a href="#u5BF9_u8C61_u7684_u521B_u5EFA" class="headerlink" title="å¯¹è±¡çš„åˆ›å»º"></a>å¯¹è±¡çš„åˆ›å»º</h3><p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/jvm-new.png" alt="javaå¯¹è±¡çš„åˆ›å»º"></p>
<ul>
<li>è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡newæŒ‡ä»¤</li>
<li><strong>æ£€æŸ¥</strong>è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ã€‚å¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æã€åˆå§‹åŒ–è¿‡ï¼Œæ²¡æœ‰å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</li>
<li><strong>æŒ‡é’ˆç¢°æ’</strong>ï¼šè‹¥å¹²Javaå †ä¸­å†…å­˜æ˜¯ç»å¯¹è§„æ•´çš„ï¼Œæ‰€æœ‰ç”¨è¿‡çš„å†…å­˜éƒ½æ”¾åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œé‚£æ‰€åˆ†é…çš„å†…å­˜å°±ä»…ä»…æ˜¯æŠŠé‚£ä¸ªæŒ‡é’ˆå‘ç©ºé—²ç©ºé—´é‚£è¾¹æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»ã€‚</li>
<li><strong>ç©ºé—²åˆ—è¡¨</strong>ï¼šå¦‚æœjavaå †ä¸­çš„å†…å­˜å¹¶ä¸æ˜¯è§„æ•´çš„ï¼Œå·²ä½¿ç”¨çš„å†…å­˜å’Œç©ºé—²çš„å†…å­˜ç›¸äº’äº¤é”™ï¼ŒJVMå¿…é¡»ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ç”¨æ¥è®°å½•å“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•</li>
<li>å†…å­˜åˆ†é…å®Œæˆä»¥åï¼Œè™šæ‹Ÿæœºéœ€è¦å°†<strong>åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼</strong>ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œç¡®ä¿å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨Javaä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚</li>
<li>æ¥ä¸‹æ¥ï¼Œ<strong>JVMå¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®</strong>ï¼Œä¾‹å¦‚ï¼šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œå€¼ã€å¯¹è±¡çš„GCåˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ï¼ˆObject Headerï¼‰ä¸­ã€‚</li>
<li>ä¸Šé¢çš„å·¥ä½œå®Œæˆä¹‹åï¼Œ<strong>ä»JVMçš„è§’åº¦ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡ä»¥åŠäº§ç”Ÿ</strong>äº†ã€‚</li>
<li><strong>å¯¹Javaç¨‹åºæ¥è¯´ï¼Œå¯¹è±¡æ‰€æœ‰çš„å­—æ®µéƒ½ä¸ºé›¶å€¼</strong>ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡ŒnewæŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œ<init>æ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡å°±å®Œå…¨äº§ç”Ÿå‡ºæ¥ã€‚</init></li>
</ul>
<h3 id="u5BF9_u8C61_u7684_u5185_u5B58_u5E03_u5C40"><a href="#u5BF9_u8C61_u7684_u5185_u5B58_u5E03_u5C40" class="headerlink" title="å¯¹è±¡çš„å†…å­˜å¸ƒå±€"></a>å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h3><p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/jvm-object.png" alt="å¯¹è±¡çš„å†…å­˜å¸ƒå±€"></p>
<h3 id="u5BF9_u8C61_u7684_u8BBF_u95EE_u5B9A_u4F4D"><a href="#u5BF9_u8C61_u7684_u8BBF_u95EE_u5B9A_u4F4D" class="headerlink" title="å¯¹è±¡çš„è®¿é—®å®šä½"></a>å¯¹è±¡çš„è®¿é—®å®šä½</h3><p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/jvm-object-visit.png" alt="å¯¹è±¡çš„è®¿é—®å®šä½"></p>
<ul>
<li>ä½¿ç”¨<strong>å¥æŸ„è®¿é—®</strong>ï¼šJavaå †ä¸­å°†åˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreferenceä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„åœ°å€ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯</li>
<li>ä½¿ç”¨<strong>ç›´æ¥æŒ‡é’ˆè®¿é—®</strong>ï¼šJavaå †å¯¹è±¡çš„å¸ƒå±€ä¸­å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®ç›¸å…³ä¿¡æ¯ï¼Œè€Œreferenceä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡åœ°å€</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>ä»¥å¸¸ç”¨çš„è™šæ‹ŸæœºHotSpotå’Œå¸¸ç”¨çš„å†…å­˜åŒºåŸŸJavaå †ä¸ºä¾‹ï¼Œæ·±å…¥æ¢è®¨HotSpotè™šæ‹Ÿæœºåœ¨Javaå †ä¸­å¯¹è±¡åˆ†é…ã€å¸ƒå±€å’Œè®¿é—®çš„å…¨è¿‡ç¨‹ã€‚</p>
<h3 id="u5BF9_u8C61_u7684_u521B_u5EFA"><a href="#u5BF9_u8C61_u7684]]>
    </summary>
    
      <category term="JVM" scheme="http://suqun.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[JVMç¬”è®°ä¸€ï¼šJavaå†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸â€”â€”è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ]]></title>
    <link href="http://suqun.github.io/2016/12/25/JVM-note-1/"/>
    <id>http://suqun.github.io/2016/12/25/JVM-note-1/</id>
    <published>2016-12-25T06:56:19.000Z</published>
    <updated>2017-02-18T13:13:18.000Z</updated>
    <content type="html"><![CDATA[<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com//jvm-runtime-illustration.png" alt="Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒº"></p>
<h3 id="u7A0B_u5E8F_u8BA1_u6570_u5668"><a href="#u7A0B_u5E8F_u8BA1_u6570_u5668" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h3><p>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚åœ¨è™šæ‹Ÿæœºçš„æ¦‚å¿µæ¨¡å‹é‡Œï¼Œå­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</p>
<p>ç”±äºJavaè™šæ‹Ÿæœºçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼æ¥å®ç°çš„ï¼Œ<strong>åœ¨ä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨ï¼ˆå¤šæ ¸å¤„ç†å™¨çš„ä¸€ä¸ªå†…æ ¸ï¼‰éƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹çš„æŒ‡ä»¤ã€‚å› æ­¤ä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„æ¡çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨</strong>ã€‚æˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸ºã€çº¿ç¨‹ç§æœ‰ã€çš„å†…å­˜ã€‚</p>
<p>å¦‚æœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œä¸€ä¸ªJavaæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„å°±æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœæ‰§è¡Œçš„æ˜¯ä¸€ä¸ªNativeæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨å€¼ä¸ºç©ºï¼ˆUndefinedï¼‰ã€‚</p>
<p>æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚</p>
<h3 id="u865A_u62DF_u673A_u6808"><a href="#u865A_u62DF_u673A_u6808" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h3><p>ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼Œ<strong>Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰ä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ</strong>ã€‚</p>
<font color="red">è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹</font>ï¼š<strong>æ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­çš„å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹</strong>ã€‚<br><br><font color="red">å±€éƒ¨å˜é‡è¡¨</font>

<ul>
<li><strong>å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹</strong>ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€<strong>å¯¹è±¡å¼•ç”¨</strong>ï¼ˆreferenceç±»å‹ï¼Œå®ƒä¸ç­‰åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰å’Œ<strong>returnAddressç±»å‹</strong>ï¼ˆæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚</li>
<li>å…¶ä¸­64ä½é•¿åº¦çš„longå’Œdoubleç±»å‹çš„æ•°æ®ä¼šå ç”¨2ä¸ªå±€éƒ¨å˜é‡ç©ºé—´ï¼ˆSlotï¼‰ï¼Œå…¶ä½™çš„æ•°æ®ç±»å‹åªå ç”¨ä¸€ä¸ªã€‚</li>
<li>å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å†…å­˜ç©ºé—´åœ¨ç¼–è¯‘æœŸé—´å®Œæˆåˆ†é…ï¼Œå½“è¿›å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨å¸§ä¸­åˆ†é…å¤šå¤§çš„å±€éƒ¨å˜é‡ç©ºé—´æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œåœ¨æ–¹æ³•çš„è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡çš„å¤§å°ã€‚</li>
</ul>
<p>åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œå¯¹è¿™ä¸ªåŒºåŸŸè§„å®š2ç§å¼‚å¸¸æƒ…å†µï¼š</p>
<ul>
<li>å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºå…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowErrorå¼‚å¸¸</li>
<li>å¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œæ‰©å±•ç”³è¯·æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸</li>
</ul>
<h3 id="u672C_u5730_u65B9_u6CD5_u6808"><a href="#u672C_u5730_u65B9_u6CD5_u6808" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h3><p><font color="red">æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ä¸è™šæ‹Ÿæœºæ ˆå‘æŒ¥çš„ä½œç”¨æ˜¯éå¸¸ç›¸ä¼¼çš„</font>ï¼Œä»–ä»¬ä¹‹é—´çš„<font color="red">åŒºåˆ«</font>ï¼š<strong>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡</strong>ã€‚</p>
<p>ä¸è™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆåŒºåŸŸä¹Ÿä¼šæŠ›å‡ºStackOverflowErrorå’ŒOutOfMemoryErrorå¼‚å¸¸ã€‚</p>
<h3 id="Java_u5806"><a href="#Java_u5806" class="headerlink" title="Javaå †"></a>Javaå †</h3><p><font color="red">Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜</font>ã€‚</p>
<p>Javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œä¹Ÿè¢«ç§°ä¸ºã€GCå †ã€ã€‚ä»å†…å­˜å›æ”¶çš„è§’åº¦çœ‹ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬ä¸Šéƒ½é‡‡ç”¨<strong>åˆ†ä»£æ”¶é›†ç®—æ³•</strong>ï¼Œæ‰€ä»¥javaå †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼š<strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£</strong>ï¼›åœ¨ç»†è‡´ä¸€ç‚¹çš„æœ‰Edenç©ºé—´ã€From Survivorç©ºé—´ã€To Survivorç©ºé—´ç­‰ã€‚</p>
<p>æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼Œ<strong>Javaå †</strong>å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåªè¦é€»è¾‘ä¸Šçš„è¿ç»­å³å¯ï¼Œå°±åƒæˆ‘ä»¬çš„ç£ç›˜ç©ºé—´ä¸€æ ·ã€‚åœ¨å®ç°æ—¶ï¼Œæ—¢å¯ä»¥å®ç°æˆå›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‰©å±•çš„ï¼Œä¸è¿‡å½“å‰ä¸»æµçš„è™šæ‹Ÿæœºéƒ½æ˜¯æŒ‰ç…§<strong>å¯æ‰©å±•æ¥</strong>å®ç°çš„ï¼ˆ<strong>é€šè¿‡-Xmxå’Œ-Xmsæ§åˆ¶</strong>ï¼‰ã€‚å¦‚æœå †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p>
<h3 id="u65B9_u6CD5_u533A"><a href="#u65B9_u6CD5_u533A" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h3><p>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¸Javaå †ä¸€æ ·ï¼Œæ˜¯<strong>å„ä¸ªçº¿ç¨‹å…±äº«</strong>çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äº<strong>å­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®</strong>ã€‚è™½ç„¶Javaè™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªåˆ«åå«Non-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„å°±æ˜¯ä¸Javaå †åŒºåˆ†å¼€æ¥ã€‚</p>
<p>å¯¹äºä¹ æƒ¯åœ¨HotSpotè™šæ‹Ÿæœºä¸Šå¼€å‘ã€éƒ¨ç½²ç¨‹åºçš„å¼€å‘è€…æ¥è¯´ï¼Œå¾ˆå¤šäººæ›´æ„¿æ„æŠŠæ–¹æ³•åŒºæˆä¸ºã€æ°¸ä¹…ä»£ã€ï¼ˆPermanent Generation)ï¼Œæœ¬è´¨ä¸Šä¸¤è€…å¹¶ä¸ç­‰ä»·ï¼Œä»…ä»…æ˜¯å› ä¸ºHotSpotè™šæ‹Ÿæœºçš„è®¾è®¡å›¢é˜Ÿé€‰æ‹©æŠŠGCåˆ†ä»£æ”¶é›†æ‰©å±•è‡³æ–¹æ³•åŒºï¼Œæˆ–è€…è¯´ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºè€Œå·²ï¼Œè¿™æ ·HotSpotçš„åƒåœ¾æ”¶é›†å™¨å¯ä»¥åƒç®¡ç†Javaå †ä¸€æ ·ç®¡ç†è¿™éƒ¨åˆ†å†…å­˜ï¼Œèƒ½å¤Ÿçœå»å•ç‹¬ä¸ºæ–¹æ³•åŒºç¼–å†™å†…å­˜ç®¡ç†ä»£ç çš„å·¥ä½œã€‚åœ¨å·²ç»å‘å¸ƒçš„JDK1.7çš„HotSpotä¸­ï¼Œå·²ç»æŠŠåŸæœ¬æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ç§»å‡ºã€‚</p>
<p>Javaè™šæ‹Ÿæœºè§„èŒƒå¯¹æ–¹æ³•åŒºçš„é™åˆ¶éå¸¸å®½æ¾ï¼Œé™¤äº†å’ŒJavaå †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜å’Œå¯ä»¥é€‰æ‹©å›ºå®šå¤§å°æˆ–è€…å¯æ‰©å±•å¤–ï¼Œè¿˜å¯ä»¥é€‰æ‹©ä¸å®ç°åƒåœ¾æ”¶é›†ã€‚ç›¸å¯¹è€Œè¨€ï¼Œåƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œä½†å¹¶éæ•°æ®è¿›å…¥äº†æ–¹æ³•åŒºå°±å¦‚æ°¸ä¹…ä»£çš„åå­—ä¸€æ ·ã€æ°¸ä¹…ã€å­˜åœ¨äº†ã€‚è¿™ä¸ªåŒºåŸŸçš„å†…å­˜å›æ”¶ç›®æ ‡ä¸»è¦æ˜¯é’ˆå¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»å‹çš„å¸è½½ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªåŒºåŸŸçš„å†…å­˜å›æ”¶æˆç»©æ¯”è¾ƒéš¾ä»¥ä»¤äººæ»¡æ„ï¼Œå°¤å…¶æ˜¯ç±»å‹çš„å¸è½½ï¼Œæ¡ä»¶ç›¸å½“è‹›åˆ»ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†åŒºåŸŸçš„å›æ”¶ç¡®å®æ˜¯å¿…è¦çš„ã€‚</p>
<p>æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼Œæ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p>
<h4 id="u8FD0_u884C_u65F6_u5E38_u91CF_u6C60"><a href="#u8FD0_u884C_u65F6_u5E38_u91CF_u6C60" class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h4><p><strong>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†</strong>ã€‚Classæ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œæœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼ˆConstant Pool Tableï¼‰ï¼Œ<strong>ç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦åˆå¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½è¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾</strong>ã€‚</p>
<p>æ—¢ç„¶è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆè‡ªç„¶å—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p>
<h3 id="u76F4_u63A5_u5185_u5B58"><a href="#u76F4_u63A5_u5185_u5B58" class="headerlink" title="ç›´æ¥å†…å­˜"></a>ç›´æ¥å†…å­˜</h3><p>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚ä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹çš„ä½¿ç”¨ï¼Œè€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´OutOfMemoryErrorå¼‚å¸¸å‡ºç°ã€‚æ‰€ä»¥æˆ‘ä»¬æ”¾åˆ°ä¸€èµ·è®²ã€‚</p>
<p>åœ¨Jdk1.4ä¸­æ–°åŠ å…¥äº†NIOï¼ˆNew Input/Output)ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“ï¼ˆChannelï¼‰ä¸ç¼“å­˜åŒºï¼ˆBufferï¼‰çš„I/Oæ–¹å¼ï¼Œä»–å¯ä»¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †ä¸­çš„DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜å†…å­˜ï¼Œå› ä¸ºé¿å…äº†Javaå †å’ŒNativeå †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚</p>
<p>æ˜¾ç„¶ï¼Œæœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ°Javaå †å¤§å°çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜ï¼Œè‚¯å®šè¿˜æ˜¯å—åˆ°æœ¬æœºæ€»å†…å­˜ï¼ˆåŒ…æ‹¬RAMä»¥åŠSWAPåŒºæˆ–è€…åˆ†é¡µæ–‡ä»¶ï¼‰å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚æœåŠ¡å™¨ç®¡ç†å‘˜åœ¨é…ç½®è™šæ‹Ÿæœºå‚æ•°æ—¶ï¼Œä¼šæ ¹æ®å®é™…å†…å­˜è®¾ç½®-Xmxç­‰å‚æ•°ä¿¡æ¯ï¼Œä½†æ˜¯<strong>ç»å¸¸å¿½ç•¥ç›´æ¥å†…å­˜ï¼Œä½¿å¾—å„ä¸ªå†…å­˜åŒºåŸŸæ€»å’Œå¤§äºç‰©ç†å†…å­˜é™åˆ¶ï¼ˆåŒ…æ‹¬ç‰©ç†çš„å’Œæ“ä½œç³»ç»Ÿçš„é™åˆ¶ï¼‰ï¼Œä»è€Œå¯¼è‡´OutOfMemoryErrorå¼‚å¸¸</strong>ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com//jvm-runtime-illustration.png" alt="Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒº"></p>
<h3 id="u7A0B_u5E8F_u8BA1_u6570_u]]>
    </summary>
    
      <category term="JVM" scheme="http://suqun.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java NIO SocketChannel]]></title>
    <link href="http://suqun.github.io/2016/11/27/Java-NIO-SocketChannel/"/>
    <id>http://suqun.github.io/2016/11/27/Java-NIO-SocketChannel/</id>
    <published>2016-11-27T13:12:38.000Z</published>
    <updated>2016-11-29T07:16:46.000Z</updated>
    <content type="html"><![CDATA[<p>åŸæ–‡ï¼š<a href="http://tutorials.jenkov.com/java-nio/socketchannel.html" target="_blank" rel="external">http://tutorials.jenkov.com/java-nio/socketchannel.html</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>åŸæ–‡ï¼š<a href="http://tutorials.jenkov.com/java-nio/socketchannel.html" target="_blank" rel="external">http://tutorials.jenkov.com/java-nio/]]>
    </summary>
    
      <category term="Java NIO" scheme="http://suqun.github.io/tags/Java-NIO/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java NIO FileChannel]]></title>
    <link href="http://suqun.github.io/2016/11/22/Java-NIO-FileChannel/"/>
    <id>http://suqun.github.io/2016/11/22/Java-NIO-FileChannel/</id>
    <published>2016-11-21T16:14:33.000Z</published>
    <updated>2016-11-27T13:11:40.000Z</updated>
    <content type="html"><![CDATA[<p>åŸæ–‡ï¼š[<a href="http://tutorials.jenkov.com/java-nio/file-channel.html]{http://tutorials.jenkov.com/java-nio/file-channel.html}" target="_blank" rel="external">http://tutorials.jenkov.com/java-nio/file-channel.html]{http://tutorials.jenkov.com/java-nio/file-channel.html}</a></p>
<p>Java NIOä¸­çš„FileChannelæ˜¯ä¸€ä¸ªè¿æ¥æ–‡ä»¶çš„channelï¼Œå¯ä»¥ä½¿ç”¨å®ƒä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®æˆ–å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ã€‚Java NIOçš„FileChannelæ˜¯NIOçš„ä¸€ä¸ªé€‰æ‹©ç›¸å¯¹æ ‡å‡†çš„Java IO APIæ¥è¯´ã€‚</p>
<p>FileChannelå¯ä»¥è®¾ç½®æˆéé˜»å¡æ¨¡å¼ï¼Œä½†æ˜¯ä»ç„¶ä¼šæŒ‰ç…§é˜»å¡æ¨¡å¼è¿è¡Œã€‚</p>
<h2 id="u6253_u5F00FileChannel"><a href="#u6253_u5F00FileChannel" class="headerlink" title="æ‰“å¼€FileChannel"></a>æ‰“å¼€FileChannel</h2><p>åœ¨ä½¿ç”¨FileChannelæ—¶éœ€è¦å…ˆæ‰“å¼€å®ƒï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥æ‰“å¼€ã€‚éœ€è¦å€ŸåŠ©InputStream,OutputStreamæˆ–è€…æ˜¯RandomAccessFileã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RandomAccessFile aFile     = <span class="keyword">new</span> RandomAccessFile(<span class="string">"data/nio-data.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel      inChannel = aFile.getChannel();</span><br></pre></td></tr></table></figure>
<h2 id="u4ECEFileChannel_u8BFB_u6570_u636E"><a href="#u4ECEFileChannel_u8BFB_u6570_u636E" class="headerlink" title="ä»FileChannelè¯»æ•°æ®"></a>ä»FileChannelè¯»æ•°æ®</h2><p>ä»FileChannelè¯»æ•°æ®å¯ä»¥è°ƒç”¨<code>read()</code>æ–¹æ³•ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> bytesRead = inChannel.read(buf);</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆç»™Bufferåˆ†é…å­—èŠ‚ï¼Œ FileChannelä¸­çš„æ•°æ®å°±æ˜¯è¯»åˆ°Bufferä¸­ã€‚</p>
<p>å…¶æ¬¡ï¼Œå†è°ƒç”¨<code>FileChannel.read()</code>æ–¹æ³•ã€‚ä»FileChannelä¸­å°†æ•°æ®è¯»å…¥bufferã€‚read()çš„æ•´å‹è¿”å›å€¼å‘Šè¯‰æˆ‘ä»¬å·²ç»å†™å…¥Bufferçš„å­—èŠ‚é‡ã€‚å¦‚æœè¿”å›<code>-1</code>,å°±æ˜¯è¯»åˆ°äº†æ–‡ä»¶çš„ç»“å°¾ã€‚</p>
<h2 id="FileChannel_u5199_u5165_u6570_u636E"><a href="#FileChannel_u5199_u5165_u6570_u636E" class="headerlink" title="FileChannelå†™å…¥æ•°æ®"></a>FileChannelå†™å…¥æ•°æ®</h2><p>Writing data to a FileChannel is done using the FileChannel.write() method, which takes a Buffer as parameter. Here is an example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String newData = <span class="string">"New String to write to file..."</span> + System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">buf.clear();</span><br><span class="line">buf.put(newData.getBytes());</span><br><span class="line"></span><br><span class="line">buf.flip();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(buf.hasRemaining()) &#123;</span><br><span class="line">    channel.write(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Notice how the FileChannel.write() method is called inside a while-loop. There is no guarantee of how many bytes the write() method writes to the FileChannel. Therefore we repeat the write() call until the Buffer has no further bytes to write.</p>
<h2 id="u5173_u95EDFileChannel"><a href="#u5173_u95EDFileChannel" class="headerlink" title="å…³é—­FileChannel"></a>å…³é—­FileChannel</h2><p>When you are done using a FileChannel you must close it. Here is how that is done:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.close();</span><br></pre></td></tr></table></figure>
<h2 id="FileChannel_Position"><a href="#FileChannel_Position" class="headerlink" title="FileChannel Position"></a>FileChannel Position</h2><p>When reading or writing to a FileChannel you do so at a specific position. You can obtain the current position of the FileChannel object by calling the position() method.</p>
<p>You can also set the position of the FileChannel by calling the position(long pos) method.</p>
<p>Here are two examples:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> pos channel.position();</span><br><span class="line"></span><br><span class="line">channel.position(pos +<span class="number">123</span>);</span><br></pre></td></tr></table></figure>
<p>If you set the position after the end of the file, and try to read from the channel, you will get -1 - the end-of-file marker.</p>
<p>If you set the position after the end of the file, and write to the channel, the file will be expanded to fit the position and written data. This may result in a â€œfile holeâ€, where the physical file on the disk has gaps in the written data.</p>
<h2 id="FileChannel_Size"><a href="#FileChannel_Size" class="headerlink" title="FileChannel Size"></a>FileChannel Size</h2><p>The size() method of the FileChannel object returns the file size of the file the channel is connected to. Here is a simple example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> fileSize = channel.size();</span><br></pre></td></tr></table></figure>
<h2 id="FileChannel_Truncate"><a href="#FileChannel_Truncate" class="headerlink" title="FileChannel Truncate"></a>FileChannel Truncate</h2><p>You can truncate a file by calling the FileChannel.truncate() method. When you truncate a file, you cut it off at a given length. Here is an example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.truncate(<span class="number">1024</span>);</span><br></pre></td></tr></table></figure>
<p>This example truncates the file at 1024 bytes in length.</p>
<h2 id="FileChannel_Force"><a href="#FileChannel_Force" class="headerlink" title="FileChannel Force"></a>FileChannel Force</h2><p>The FileChannel.force() method flushes all unwritten data from the channel to the disk. An operating system may cache data in memory for performance reasons, so you are not guaranteed that data written to the channel is actually written to disk, until you call the force() method.</p>
<p>The force() method takes a boolean as parameter, telling whether the file meta data (permission etc.) should be flushed too.</p>
<p>Here is an example which flushes both data and meta data:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.force(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>åŸæ–‡ï¼š[<a href="http://tutorials.jenkov.com/java-nio/file-channel.html]{http://tutorials.jenkov.com/java-nio/file-channel.html}" target="_bl]]>
    </summary>
    
      <category term="Java NIO" scheme="http://suqun.github.io/tags/Java-NIO/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java NIO Selector]]></title>
    <link href="http://suqun.github.io/2016/11/16/Java-NIO-Selector/"/>
    <id>http://suqun.github.io/2016/11/16/Java-NIO-Selector/</id>
    <published>2016-11-16T14:27:08.000Z</published>
    <updated>2016-11-21T16:10:19.000Z</updated>
    <content type="html"><![CDATA[<p>åŸæ–‡ï¼š<a href="http://tutorials.jenkov.com/java-nio/selectors.html" target="_blank" rel="external">http://tutorials.jenkov.com/java-nio/selectors.html</a></p>
<p><code>Selector</code>æ˜¯Java NIOä¸­ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªNIOé€šé“çš„ï¼Œå†³å®šå“ªä¸ªé€šé“åšå¥½å‡†å¤‡è¿›è¡Œè¯»å†™çš„ç»„ä»¶ã€‚è¿™æ ·ï¼Œä¸€ä¸ªå•çº¿ç¨‹å°±å¯ä»¥ç®¡ç†å¤šä¸ªé€šé“ï¼Œä»¥ä¾¿ç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ã€‚</p>
<h2 id="u4E3A_u4F55_u4F7F_u7528Selector_3F"><a href="#u4E3A_u4F55_u4F7F_u7528Selector_3F" class="headerlink" title="ä¸ºä½•ä½¿ç”¨Selector?"></a>ä¸ºä½•ä½¿ç”¨Selector?</h2><p>ä½¿ç”¨å•çº¿ç¨‹å¤„ç†å¤šé€šé“çš„å¥½å¤„å°±æ˜¯å¯ä»¥ä½¿ç”¨æ›´å°‘çš„çº¿ç¨‹å¤„ç†å¤šä¸ªé€šé“ã€‚å®é™…ä¸Šå¯ä»¥ä½¿ç”¨åªç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªé€šé“ã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹åˆ‡æ¢å¼€é”€å¾ˆå¤§ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šå ç”¨ä¸€äº›èµ„æºï¼ˆå†…å­˜ï¼‰ã€‚å› æ­¤ï¼Œçº¿ç¨‹è¶Šå°‘è¶Šå¥½ã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“å‰æ“ä½œç³»ç»Ÿå’ŒCPUå¤šä»»åŠ¡å¤„ç†ä¸Šå·²ç»éå¸¸å¥½ï¼Œå¤šçº¿ç¨‹çš„å¼€é”€å·²ç»å˜å¾—å¾ˆå°äº†ã€‚å¦‚æœä¸€ä¸ªCPUæœ‰å¤šä¸ªå†…æ ¸ï¼Œä¸ä½¿ç”¨å¤šä»»åŠ¡å¯èƒ½æ˜¯åœ¨æµªè´¹CPUèƒ½åŠ›ã€‚ä¸ç®¡æ€ä¹ˆè¯´ï¼Œå…³äºé‚£ç§è®¾è®¡çš„è®¨è®ºåº”è¯¥æ”¾åœ¨å¦ä¸€ç¯‡ä¸åŒçš„æ–‡ç« ä¸­ã€‚åœ¨è¿™é‡Œï¼Œåªè¦çŸ¥é“ä½¿ç”¨Selectorèƒ½å¤Ÿå¤„ç†å¤šä¸ªé€šé“å°±è¶³å¤Ÿäº†ã€‚</p>
<p>ä½¿ç”¨ä¸€ä¸ªSelectorå¤„ç†3ä¸ªchannelçš„å›¾è§£å¦‚ä¸‹ï¼š</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/JavaNIOSelectors.png" alt="
Java NIO: A Thread uses a Selector to handle 3 Channel&#39;s"></p>
<h2 id="Selector_u7684_u521B_u5EFA"><a href="#Selector_u7684_u521B_u5EFA" class="headerlink" title="Selectorçš„åˆ›å»º"></a>Selectorçš„åˆ›å»º</h2><p>è°ƒç”¨<code>Selector.open()</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªselectorã€‚åƒè¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Selector selector = Selector.open();</span><br></pre></td></tr></table></figure>
<h2 id="Channel_u6CE8_u518C_u5230Selector_u4E0A"><a href="#Channel_u6CE8_u518C_u5230Selector_u4E0A" class="headerlink" title="Channelæ³¨å†Œåˆ°Selectorä¸Š"></a>Channelæ³¨å†Œåˆ°Selectorä¸Š</h2><p>ä¸ºäº†ç»“åˆSelectorä½¿ç”¨Channelï¼Œé¦–å…ˆè¦å°†Channelæ³¨å†Œåˆ°Selectorä¸Šã€‚é€šè¿‡æ–¹æ³•<code>SelectableChannel.register()</code>å®ç°:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">SelectionKey key = channel.register(selector, SelectionKey.OP_READ);</span><br></pre></td></tr></table></figure>
<p>ç»“åˆSelectorä½¿ç”¨æ—¶ï¼ŒChannelå¿…é¡»æ˜¯éé˜»å¡å¸ˆçš„ã€‚è¿™å°±æ„å‘³ç€ï¼Œä½ ä¸èƒ½æŠŠFileChannelå’ŒSelectorç»“åˆä½¿ç”¨ï¼Œå› ä¸ºFileChannelä¸èƒ½åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼ã€‚Socket Channelç¡®å¯ä»¥å¾ˆå¥½çš„ç»“åˆSelectorä½¿ç”¨ã€‚</p>
<p><code>register()</code>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°éœ€è¦æ³¨æ„ä¸‹ã€‚è¿™æ˜¯ä¸ªæœ‰è¶£çš„è®¾ç½®ï¼Œæ„æ€æ˜¯åœ¨é€šè¿‡Selectorç›‘å¬Channelæ—¶åˆšå…´è¶£çš„äº‹ä»¶ã€‚å¯ä»¥ç›‘å¬åˆ°ä»¥ä¸‹å››ç§äº‹ä»¶ï¼š</p>
<ul>
<li>Connect</li>
<li>Accept</li>
<li>Read</li>
<li>Write</li>
</ul>
<p>ä¸€ä¸ªchannelè§¦å‘äº†äº‹ä»¶å°±æ˜¯æ„å‘³ç€è¯¥äº‹ä»¶å·²å°±ç»ªã€‚å› æ­¤ï¼Œchannelè¿æ¥æœåŠ¡æˆåŠŸå°±æ˜¯<code>Connect</code>å°±ç»ªã€‚æœåŠ¡socke channelå‡†å¤‡æ¥å—è¿›å…¥çš„è¿æ¥å°±æ˜¯<code>Accept</code>å°±ç»ªã€‚æœåŠ¡socket channelå·²ç»å‡†å¤‡å¥½äº†å¯ä»¥è¯»å–çš„æ•°æ®å°±æ˜¯<code>Read</code>å°±ç»ªã€‚channelå‡†å¤‡å¥½å¯ä»¥å†™å…¥æ•°æ®å°±æ˜¯<code>Write</code>å°±ç»ªã€‚</p>
<p>è¿™å››ç§äº‹ä»¶ç”¨SelectionKeyçš„å¸¸é‡è¡¨ç¤ºï¼š </p>
<ul>
<li>SelectionKey.OP_CONNECT</li>
<li>SelectionKey.OP_ACCEPT</li>
<li>SelectionKey.OP_READ</li>
<li>SelectionKey.OP_WRITE</li>
</ul>
<p>å¦‚æœå¯¹å¤šä¸ªäº‹ä»¶æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨â€œä½æˆ–â€æ“ä½œç¬¦å°†å¸¸é‡è¿æ¥èµ·æ¥ï¼Œåƒè¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢è¿˜ä¼šç»§ç»­æåˆ°interesté›†åˆã€‚</p>
<h2 id="SelectionKey"><a href="#SelectionKey" class="headerlink" title="SelectionKey"></a>SelectionKey</h2><p>é€šè¿‡å‰é¢ç¤ºä¾‹å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨<code>register()</code>æ–¹æ³•å‘selectorä¸Šæ³¨å†Œchannelæ—¶è¿”å›<code>SelectionKey</code>å¯¹è±¡ã€‚è¿™ä¸ª<code>SelectionKey</code>å¯¹è±¡ä¸­åŒ…å«å¾ˆå¤šæœ‰è¶£çš„å±æ€§ã€‚</p>
<ul>
<li>interesté›†åˆ</li>
<li>ready é›†åˆ</li>
<li>Channel</li>
<li>Selector</li>
<li>é™„åŠ å¯¹è±¡ï¼ˆå¯é€‰ï¼‰</li>
</ul>
<p>ä¸‹é¢ä¼šæè¿°è¿™äº›å±æ€§ã€‚</p>
<h3 id="Interest_u96C6_u5408"><a href="#Interest_u96C6_u5408" class="headerlink" title="Interesté›†åˆ"></a>Interesté›†åˆ</h3><p>å°±åƒå‘Selectoræ³¨å†Œé€šé“ä¸€èŠ‚ä¸­æ‰€æè¿°çš„ï¼Œinteresté›†åˆæ˜¯ä½ æ‰€é€‰æ‹©çš„æ„Ÿå…´è¶£çš„äº‹ä»¶é›†åˆã€‚é€šè¿‡SelectionKeyå¯ä»¥è¯»å†™interesté›†åˆã€‚ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> interestSet = selectionKey.interestOps();</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> isInterestedInAccept  = interestSet &amp; SelectionKey.OP_ACCEPT;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInConnect = interestSet &amp; SelectionKey.OP_CONNECT;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInRead    = interestSet &amp; SelectionKey.OP_READ;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInWrite   = interestSet &amp; SelectionKey.OP_WRITE;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ã€ä½ä¸ã€æ“ä½œinteresté›†åˆå’Œç»™å®šçš„çš„SelectionKeyå¸¸é‡ï¼Œå¯ä»¥ç¡®å®šæŸä¸ªç¡®å®šçš„ä¸–ç•Œæ˜¯å¦åœ¨interesté›†åˆä¸­ã€‚</p>
<h3 id="Ready_u96C6_u5408"><a href="#Ready_u96C6_u5408" class="headerlink" title="Readyé›†åˆ"></a>Readyé›†åˆ</h3><p>readyé›†åˆæ˜¯channelå·²ç»å‡†å¤‡å°±ç»ªçš„channelé›†åˆã€‚åœ¨ä¸€æ¬¡<code>selection</code>ä»¥åï¼Œå¯ä»¥å…ˆè·å¾—readyé›†åˆã€‚è‡³äº<code>selecton</code>ï¼Œä¼šå†ä¸‹é¢çš„ç« èŠ‚è§£é‡Šã€‚å¯ä»¥è¿™æ ·è·å–readyé›†åˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> readySet = selectionKey.readyOps();</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç”¨åƒæ£€æµ‹interesté›†åˆé‚£æ ·çš„æ–¹æ³•ï¼Œæ¥æ£€æµ‹channelä¸­ä»€ä¹ˆäº‹ä»¶æˆ–æ“ä½œå·²ç»å°±ç»ªã€‚ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å››ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬éƒ½ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">selectionKey.isAcceptable();</span><br><span class="line">selectionKey.isConnectable();</span><br><span class="line">selectionKey.isReadable();</span><br><span class="line">selectionKey.isWritable();</span><br></pre></td></tr></table></figure>
<h3 id="Channel_+_Selector"><a href="#Channel_+_Selector" class="headerlink" title="Channel + Selector"></a>Channel + Selector</h3><p>Accessing the channel + selector from the SelectionKey is trivial. Here is how itâ€™s done:<br>ä»SelectionKeyä¸­è·å¾—channelå’Œselectorå¾ˆç®€å•ï¼Œåƒè¿™æ ·å°±å¥½:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Channel  channel  = selectionKey.channel();</span><br><span class="line">Selector selector = selectionKey.selector();</span><br></pre></td></tr></table></figure>
<h3 id="u9644_u52A0_u5BF9_u8C61"><a href="#u9644_u52A0_u5BF9_u8C61" class="headerlink" title="é™„åŠ å¯¹è±¡"></a>é™„åŠ å¯¹è±¡</h3><p>å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡é™„åŠ åˆ°SelectionKeyä¸Šã€‚è¿™æ˜¯ä¸ªè¯†åˆ«ç»™å®šçš„channelçš„ç®€ä¾¿æ–¹æ³•ï¼Œè¿˜å¯ä»¥é™„åŠ æ›´å¤šä¿¡æ¯ä¸Šå»ã€‚æ¯”å¦‚ï¼Œé™„åŠ ä¸ªä¸channelä¸€èµ·ä½¿ç”¨çš„bufferï¼Œæˆ–è€…èšåˆæ›´å¤šæ•°æ®çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">selectionKey.attach(theObject);</span><br><span class="line">Object attachedObj = selectionKey.attachment();</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥åœ¨æ³¨å†Œæ—¶é™„åŠ å¯¹è±¡ï¼Œåƒè¿™æ ·ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SelectionKey key = channel.register(selector, SelectionKey.OP_READ, theObject);</span><br></pre></td></tr></table></figure>
<h2 id="u901A_u8FC7Selector_u9009_u62E9Channel"><a href="#u901A_u8FC7Selector_u9009_u62E9Channel" class="headerlink" title="é€šè¿‡Selectoré€‰æ‹©Channel"></a>é€šè¿‡Selectoré€‰æ‹©Channel</h2><p>ä¸€æ—¦å‘Selectoræ³¨å†Œäº†ä¸€ä¸ªæˆ–å¤šä¸ªchannelï¼Œå°±å¯ä»¥è°ƒç”¨ä»»ä¸€<code>select()</code>æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•è¿”å›é‚£äº›æ³¨å†Œæ—¶æ„Ÿå…´è¶£äº‹ä»¶ï¼ˆconnectï¼Œacceptï¼Œread æˆ–è€… writeï¼‰çš„channelã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ„Ÿå…´è¶£çš„channelå·²å¯¹è¯»æ•°æ®åšå¥½å‡†å¤‡ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨<code>select()</code>æ–¹æ³•ä»¥åï¼Œå°±ä¼šè¿”å›å¯¹è¯»å°±ç»ªçš„channelã€‚</p>
<p>selectæ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§:</p>
<ol>
<li><code>int select()</code></li>
<li><code>int select(long timeout)</code></li>
<li><code>int selectNow()</code></li>
</ol>
<p><code>select()</code> é˜»å¡ç›´åˆ°è‡³å°‘ä¸€ä¸ªchannelå·²ç»å¯¹ç›‘å¬äº‹ä»¶åšå¥½å‡†å¤‡ã€‚</p>
<p><code>select(long timeout)</code> å’Œ<code>select()</code>ä¸€æ ·ï¼Œé™¤äº†æœ€é•¿ä¼šé˜»å¡timeoutæ¯«ç§’(å‚æ•°)ã€‚</p>
<p><code>selectNow()</code> ä¸ä¼šé˜»å¡ï¼Œæ— è®ºchannelæœ‰æ²¡æœ‰å‡†å¤‡å¥½éƒ½ä¼šç›´æ¥è¿”å›ã€‚ï¼ˆæ²¡æœ‰å‡†å¤‡å¥½çš„ç›´æ¥è¿”å›0ï¼‰</p>
<p>select()æ–¹æ³•è¿”å›çš„intå€¼è¡¨ç¤ºæœ‰å¤šå°‘é€šé“å·²ç»å°±ç»ªã€‚äº¦å³ï¼Œè‡ªä¸Šæ¬¡è°ƒç”¨select()æ–¹æ³•åæœ‰å¤šå°‘é€šé“å˜æˆå°±ç»ªçŠ¶æ€ã€‚å¦‚æœè°ƒç”¨select()æ–¹æ³•ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªé€šé“å˜æˆå°±ç»ªçŠ¶æ€ï¼Œè¿”å›äº†1ï¼Œè‹¥å†æ¬¡è°ƒç”¨select()æ–¹æ³•ï¼Œå¦‚æœå¦ä¸€ä¸ªé€šé“å°±ç»ªäº†ï¼Œå®ƒä¼šå†æ¬¡è¿”å›1ã€‚å¦‚æœå¯¹ç¬¬ä¸€ä¸ªå°±ç»ªçš„channelæ²¡æœ‰åšä»»ä½•æ“ä½œï¼Œç°åœ¨å°±æœ‰ä¸¤ä¸ªå°±ç»ªçš„é€šé“ï¼Œä½†åœ¨æ¯æ¬¡select()æ–¹æ³•è°ƒç”¨ä¹‹é—´ï¼Œåªæœ‰ä¸€ä¸ªé€šé“å°±ç»ªäº†ã€‚</p>
<h3 id="selectedKeys_28_29"><a href="#selectedKeys_28_29" class="headerlink" title="selectedKeys()"></a>selectedKeys()</h3><p>è°ƒç”¨select()æ–¹æ³•åï¼Œä¸€æ—¦å…¶è¿”å›å€¼è¡¨æ˜ä¸€ä¸ªæˆ–å¤šä¸ªchannelå°±ç»ªï¼Œå°±å¯ä»¥é€šè¿‡<code>selectedKeys()</code>æ–¹æ³•è®¿é—®ã€selected key setã€ï¼ˆå·²é€‰æ‹©é”®é›†ï¼‰ä¸­çš„å°±ç»ªchannelã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨<code>Channel.register()</code>å‘selectoræ³¨å†Œchannelä»¥åè¿”å›<code>SelectionKey</code>å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å°±ä»£è¡¨äº†æ³¨å†Œåˆ°selectorçš„channelã€‚å¯ä»¥é€šè¿‡SelectionKeyå¯¹è±¡çš„<code>electedKeySet()</code>æ–¹æ³•è·å¾—è¿™äº›å¯¹è±¡ã€‚</p>
<p>éå†å·²é€‰æ‹©çš„é”®é›†è·å¾—å°±ç»ªçš„channelï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();</span><br><span class="line"></span><br><span class="line">Iterator&lt;SelectionKey&gt; keyIterator = selectedKeys.iterator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(keyIterator.hasNext()) &#123;</span><br><span class="line">    </span><br><span class="line">    SelectionKey key = keyIterator.next();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(key.isAcceptable()) &#123;</span><br><span class="line">        <span class="comment">// a connection was accepted by a ServerSocketChannel.</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isConnectable()) &#123;</span><br><span class="line">        <span class="comment">// a connection was established with a remote server.</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">        <span class="comment">// a channel is ready for reading</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123;</span><br><span class="line">        <span class="comment">// a channel is ready for writing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    keyIterator.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå¾ªç¯éå†å·²é€‰æ‹©é”®é›†ä¸­çš„æ¯ä¸ªé”®ï¼Œå¹¶æ£€æµ‹å„ä¸ªé”®æ‰€å¯¹åº”çš„é€šé“çš„å°±ç»ªäº‹ä»¶ã€‚</p>
<p>æ³¨æ„åœ¨æ¯æ¬¡éå†åè°ƒç”¨<code>keyIterator.remove()</code>æ–¹æ³•ã€‚Selectorä¸ä¼šä»å·²é€‰æ‹©é”®é›†ä¸­è‡ªåŠ¨åˆ é™¤SelectionKeyçš„å®ä¾‹ã€‚åœ¨å¤„ç†å®Œchannelåå¿…é¡»è°ƒç”¨æ­¤æ–¹æ³•ã€‚ä¸‹æ¬¡channelä¼šå‡†å¤‡å¥½ï¼ŒSelectorå°†å…¶é‡æ–°æ·»åŠ åˆ°å·²é€‰æ‹©çš„é”®é›†ä¸­ã€‚ ï¼ˆåŸæ–‡ï¼šNotice the keyIterator.remove() call at the end of each iteration. The Selector does not remove the SelectionKey instances from the selected key set itself. You have to do this, when you are done processing the channel. The next time the channel becomes â€œreadyâ€ the Selector will add it to the selected key set again.ï¼‰</p>
<p>è°ƒç”¨<code>SelectionKey.channel()</code>æ–¹æ³•ä¼šè¿”å›éœ€è¦å¤„ç†çš„channelã€‚æ¯”å¦‚ServerSocketChannelæˆ–è€…SocketChannelç­‰ã€‚</p>
<h3 id="wakeUp_28_29_u65B9_u6CD5"><a href="#wakeUp_28_29_u65B9_u6CD5" class="headerlink" title="wakeUp()æ–¹æ³•"></a>wakeUp()æ–¹æ³•</h3><p>æŸä¸ªçº¿ç¨‹è°ƒç”¨select()æ–¹æ³•ä»¥åä¼šè¢«é˜»å¡ï¼Œå³ä½¿æ²¡æœ‰å°±ç»ªçš„channelï¼Œä¹Ÿå¯ä»¥ä½¿å…¶ä»select()æ–¹æ³•è¿”å›ã€‚åªè¦è®©å…¶å®ƒçº¿ç¨‹åœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨select()æ–¹æ³•çš„é‚£ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨Selector.wakeup()æ–¹æ³•å³å¯ã€‚é˜»å¡åœ¨select()æ–¹æ³•ä¸Šçš„çº¿ç¨‹ä¼šç«‹é©¬è¿”å›ã€‚</p>
<p>å¦‚æœæœ‰å…¶å®ƒçº¿ç¨‹è°ƒç”¨äº†wakeup()æ–¹æ³•ï¼Œä½†å½“å‰æ²¡æœ‰çº¿ç¨‹é˜»å¡åœ¨select()æ–¹æ³•ä¸Šï¼Œä¸‹ä¸ªè°ƒç”¨select()æ–¹æ³•çš„çº¿ç¨‹ä¼šç«‹å³â€œé†’æ¥ï¼ˆwake upï¼‰â€ã€‚</p>
<h3 id="close_28_29_u65B9_u6CD5"><a href="#close_28_29_u65B9_u6CD5" class="headerlink" title="close()æ–¹æ³•"></a>close()æ–¹æ³•</h3><p>ç”¨å®ŒSelectoråè°ƒç”¨å…¶close()æ–¹æ³•ä¼šå…³é—­è¯¥Selectorï¼Œä¸”ä½¿æ³¨å†Œåˆ°è¯¥Selectorä¸Šçš„æ‰€æœ‰SelectionKeyå®ä¾‹æ— æ•ˆã€‚é€šé“æœ¬èº«å¹¶ä¸ä¼šå…³é—­ã€‚</p>
<h2 id="u5B8C_u6574_u7684Selector_u793A_u4F8B"><a href="#u5B8C_u6574_u7684Selector_u793A_u4F8B" class="headerlink" title="å®Œæ•´çš„Selectorç¤ºä¾‹"></a>å®Œæ•´çš„Selectorç¤ºä¾‹</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„selectorä¾‹å­ï¼Œopen,register,ç›‘å¬ç­‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Selector selector = Selector.open();</span><br><span class="line"></span><br><span class="line">channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">SelectionKey key = channel.register(selector, SelectionKey.OP_READ);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> readyChannels = selector.select();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(readyChannels == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();</span><br><span class="line"></span><br><span class="line">  Iterator&lt;SelectionKey&gt; keyIterator = selectedKeys.iterator();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(keyIterator.hasNext()) &#123;</span><br><span class="line"></span><br><span class="line">    SelectionKey key = keyIterator.next();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(key.isAcceptable()) &#123;</span><br><span class="line">        <span class="comment">// a connection was accepted by a ServerSocketChannel.</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isConnectable()) &#123;</span><br><span class="line">        <span class="comment">// a connection was established with a remote server.</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">        <span class="comment">// a channel is ready for reading</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123;</span><br><span class="line">        <span class="comment">// a channel is ready for writing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    keyIterator.remove();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>åŸæ–‡ï¼š<a href="http://tutorials.jenkov.com/java-nio/selectors.html" target="_blank" rel="external">http://tutorials.jenkov.com/java-nio/sele]]>
    </summary>
    
      <category term="Java NIO" scheme="http://suqun.github.io/tags/Java-NIO/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java NIO Channelä¹‹é—´çš„æ•°æ®ä¼ è¾“]]></title>
    <link href="http://suqun.github.io/2016/11/10/Java-NIO-Channel-to-Channel-Transfers/"/>
    <id>http://suqun.github.io/2016/11/10/Java-NIO-Channel-to-Channel-Transfers/</id>
    <published>2016-11-10T03:05:11.000Z</published>
    <updated>2016-11-16T14:24:36.000Z</updated>
    <content type="html"><![CDATA[<p>åŸæ–‡ï¼š<a href="http://tutorials.jenkov.com/java-nio/channel-to-channel-transfers.html" target="_blank" rel="external">http://tutorials.jenkov.com/java-nio/channel-to-channel-transfers.html</a></p>
<p>åœ¨Java NIO ä¸­channelä¹‹é—´å¯ä»¥ç›´æ¥ç›¸äº’ä¼ è¾“ã€‚æ¯”å¦‚ä¸€ä¸ªFileChannelç±»å‹çš„channelï¼ŒFileChannelç±»æä¾›<code>transferTo()</code>å’Œ<code>transferFrom()</code>ä¸¤ä¸ªæ–¹æ³•åšè¿™ä¸ªäº‹æƒ…ã€‚</p>
<h2 id="transferFrom_28_29"><a href="#transferFrom_28_29" class="headerlink" title="transferFrom()"></a>transferFrom()</h2><p><code>FileChannel.transferFrom()</code>æ–¹æ³•å°†ä¸€ä¸ªchannelçš„æ•°æ®ä¼ å…¥FileChannelã€‚</p>
<p>ä»£ç ğŸŒ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RandomAccessFile fromFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"fromFile.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel      fromChannel = fromFile.getChannel();</span><br><span class="line"></span><br><span class="line">RandomAccessFile toFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"toFile.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel      toChannel = toFile.getChannel();</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> position = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">long</span> count    = fromChannel.size();</span><br><span class="line"></span><br><span class="line">toChannel.transferFrom(fromChannel, position, count);</span><br></pre></td></tr></table></figure>
<p>positionå‚æ•°ç¡®å®šç›®æ ‡æ–‡ä»¶çš„ä¼ è¾“åˆå§‹ä½ç½®ï¼Œcountå‚æ•°ç¡®å®šä¼ è¾“çš„æœ€å¤§æ•°é‡ã€‚channelä¸­çš„å­—èŠ‚æ•°è‹¥æ˜¯å°‘äºcountï¼Œå°±è¯»å–å…¨éƒ¨å­—èŠ‚ã€‚<br>å¦å¤–ï¼ŒSocketChannelä¼ è¾“çš„æ˜¯å…¶å†…éƒ¨æ­¤æ—¶æ­¤å¤„çš„å°±ç»ªçš„æ•°æ®ï¼ˆSocketChannelåç»­å¯èƒ½è¿˜ä¼šæœ‰æ›´å¤šçš„å¯ç”¨æ•°æ®ï¼‰ã€‚å› æ­¤ï¼Œä»SocketChannelä¼ è¾“æ•°æ®æ—¶ï¼Œæœ‰å¯èƒ½ä¸èƒ½æŠŠå…¨éƒ¨çš„è¯·æ±‚æ•°æ®ï¼ˆä¸è¶³countçš„æ•°æ®ï¼‰éƒ½ä¼ å…¥FileChannelä¸­ã€‚</p>
<h2 id="transferTo_28_29"><a href="#transferTo_28_29" class="headerlink" title="transferTo()"></a>transferTo()</h2><p><code>transferTo()</code>æ–¹æ³•å°†FileChannelæ•°æ®ä¼ å…¥å…¶ä»–çš„channelä¸­ã€‚</p>
<p>ä»£ç ğŸŒ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RandomAccessFile fromFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"fromFile.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel      fromChannel = fromFile.getChannel();</span><br><span class="line"></span><br><span class="line">RandomAccessFile toFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"toFile.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel      toChannel = toFile.getChannel();</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> position = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">long</span> count    = fromChannel.size();</span><br><span class="line"></span><br><span class="line">fromChannel.transferTo(position, count, toChannel);</span><br></pre></td></tr></table></figure>
<p>å’Œä¸Šé¢çš„ä¾‹å­å¾ˆç›¸ä¼¼ã€‚åŒºåˆ«åœ¨äºè°ƒç”¨æ–¹æ³•çš„FileChannelå¯¹è±¡ä¸ä¸€æ ·ã€‚</p>
<p>å…³äºSocketChannelçš„é—®é¢˜åœ¨transferTo()æ–¹æ³•ä¸­åŒæ ·å­˜åœ¨ã€‚SocketChannelä¼šä¸€ç›´ä¼ è¾“æ•°æ®ç›´åˆ°ç›®æ ‡bufferè¢«å¡«æ»¡ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>åŸæ–‡ï¼š<a href="http://tutorials.jenkov.com/java-nio/channel-to-channel-transfers.html" target="_blank" rel="external">http://tutorials.jenko]]>
    </summary>
    
      <category term="Java NIO" scheme="http://suqun.github.io/tags/Java-NIO/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java NIO Scatter / Gather]]></title>
    <link href="http://suqun.github.io/2016/11/09/Java-NIO-Scatter-Gather/"/>
    <id>http://suqun.github.io/2016/11/09/Java-NIO-Scatter-Gather/</id>
    <published>2016-11-09T15:09:19.000Z</published>
    <updated>2016-11-10T03:11:19.000Z</updated>
    <content type="html"><![CDATA[<p>åŸæ–‡ï¼š<a href="http://tutorials.jenkov.com/java-nio/scatter-gather.html" target="_blank" rel="external">http://tutorials.jenkov.com/java-nio/scatter-gather.html</a></p>
<p>Java NIO ä»ä¸€å¼€å§‹å°±å†…åµŒäº†scatter/gatherçš„æ”¯æŒã€‚scatter/gatheræ˜¯ä»channelä¸­è¯»å–å†™å…¥çš„æ“ä½œæ¦‚å¿µã€‚</p>
<p><strong>scatter</strong>ï¼šä»channelä¸­å°†æ•°æ®è¯»åˆ°å¤šä¸ªbuffersä¸­çš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œchannelçš„åˆ†æ•£å™¨å°†channelä¸­çš„æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªbuffersã€‚</p>
<p><strong>gather</strong>ï¼šå°†å¤šä¸ªbuffersä¸­çš„æ•°æ®å†™å…¥ä¸€ä¸ªchannelä¸­çš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œchannelçš„æ”¶é›†å™¨ï¼Œå°†å¤šä¸ªbuffersä¸­çš„æ•°æ®æ”¶é›†åˆ°channelä¸­ã€‚</p>
<p>scatter/gatterç»å¸¸ç”¨äºéœ€è¦å°†ä¼ è¾“çš„æ•°æ®åˆ†å¼€å¤„ç†çš„åœºåˆã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªä¿¡æ¯åŒ…å«headå’Œbodyï¼Œä½ å¯èƒ½ä¼šå°†æ¶ˆæ¯ä½“å’Œæ¶ˆæ¯å¤´åˆ†æ•£åˆ°ä¸åŒçš„bufferä¸­ï¼Œè¿™æ ·ä½ å¯ä»¥æ–¹ä¾¿çš„å¤„ç†æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ã€‚</p>
<h2 id="Scattering_Reads"><a href="#Scattering_Reads" class="headerlink" title="Scattering Reads"></a>Scattering Reads</h2><p>Scattering Readsï¼Œå°†å•ä¸ªchannelä¸­çš„æ•°æ®è¯»åˆ°å¤šä¸ªbuffersä¸­ï¼Œä¸‹é¢æ˜¯åŸç†å›¾ç¤ºï¼š </p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/java-nio-scatter-read.png" alt="java-nio-scatter-read"></p>
<p>ä»£ç ğŸŒ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer header = ByteBuffer.allocate(<span class="number">128</span>);</span><br><span class="line">ByteBuffer body   = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">ByteBuffer[] bufferArray = &#123; header, body &#125;;</span><br><span class="line">channel.read(bufferArray);</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„bufferé¦–å…ˆè¢«æ’å…¥åˆ°æ•°ç»„ï¼Œç„¶åå†å°†æ•°ç»„ä½œä¸ºchannel.read() çš„è¾“å…¥å‚æ•°ã€‚read()æ–¹æ³•æŒ‰ç…§bufferåœ¨æ•°ç»„ä¸­çš„é¡ºåºå°†ä»channelä¸­è¯»å–çš„æ•°æ®å†™å…¥åˆ°bufferï¼Œå½“ä¸€ä¸ªbufferè¢«å†™æ»¡åï¼Œchannelç´§æ¥ç€å‘å¦ä¸€ä¸ªbufferä¸­å†™ã€‚</p>
<p>Scattering Readsåœ¨ç§»åŠ¨ä¸‹ä¸€ä¸ªbufferå‰ï¼Œå¿…é¡»å¡«æ»¡å½“å‰çš„bufferï¼Œè¿™ä¹Ÿæ„å‘³ç€å®ƒä¸é€‚ç”¨äºåŠ¨æ€å¤§å°æ¶ˆæ¯ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœå­˜åœ¨æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼Œæ¶ˆæ¯å¤´å¿…é¡»å®Œæˆå¡«å……ï¼ˆä¾‹å¦‚å¡«æ»¡128byteï¼‰ï¼ŒScattering Readsæ‰èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<h2 id="Gathering_Writes"><a href="#Gathering_Writes" class="headerlink" title="Gathering Writes"></a>Gathering Writes</h2><p>Gathering Writesï¼šå°†å¤šä¸ªbuffersä¸­çš„æ•°æ®å†™å…¥å•ä¸ªchannelï¼Œä¸‹é¢æ˜¯åŸç†å›¾ç¤ºï¼š</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/java-nio-gather.png" alt="Gathering Write"></p>
<p>ä»£ç ğŸŒ°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer header = ByteBuffer.allocate(<span class="number">128</span>);</span><br><span class="line">ByteBuffer body   = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//write data into buffers</span></span><br><span class="line">ByteBuffer[] bufferArray = &#123; header, body &#125;;</span><br><span class="line"></span><br><span class="line">channel.write(bufferArray);</span><br></pre></td></tr></table></figure></p>
<p>The array of buffers are passed into the write() method, which writes the buffersæ•°ç»„æ˜¯write()æ–¹æ³•çš„å…¥å‚ï¼Œwrite()æ–¹æ³•ä¼šæŒ‰ç…§bufferåœ¨æ•°ç»„ä¸­çš„é¡ºåºï¼Œå°†æ•°æ®å†™å…¥åˆ°channelï¼Œæ³¨æ„åªæœ‰positionå’Œlimitä¹‹é—´çš„æ•°æ®æ‰ä¼šè¢«å†™å…¥ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªbufferçš„å®¹é‡ä¸º128byteï¼Œä½†æ˜¯ä»…ä»…åŒ…å«58byteçš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™58byteçš„æ•°æ®å°†è¢«å†™å…¥åˆ°channelä¸­ã€‚å› æ­¤ä¸Scattering Readsç›¸åï¼ŒGathering Writesèƒ½è¾ƒå¥½çš„å¤„ç†åŠ¨æ€æ¶ˆæ¯ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>åŸæ–‡ï¼š<a href="http://tutorials.jenkov.com/java-nio/scatter-gather.html" target="_blank" rel="external">http://tutorials.jenkov.com/java-nio]]>
    </summary>
    
      <category term="Java NIO" scheme="http://suqun.github.io/tags/Java-NIO/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[IntelliJ ä½¿ç”¨è¯´æ˜]]></title>
    <link href="http://suqun.github.io/2016/10/18/IntelliJ/"/>
    <id>http://suqun.github.io/2016/10/18/IntelliJ/</id>
    <published>2016-10-18T09:38:43.000Z</published>
    <updated>2016-10-20T02:49:19.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>Windowsä¸‹è½½åœ°å€ï¼š<a href="https://www.jetbrains.com/idea/download/#section=windows" target="_blank" rel="external">https://www.jetbrains.com/idea/download/#section=windows</a></p>
<p>ç‰ˆæœ¬é€‰æ‹©Ultimate</p>
<p>ä¸‹è½½çš„æ–‡ä»¶ç›´æ¥åŒå‡»ä¸€è·¯nextå®‰è£…å³å¯ã€‚å®‰è£…ç»“æŸä»¥åè¿è¡Œèµ·æ¥åï¼Œé€šè¿‡Serveræ–¹å¼ç ´è§£</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/%E7%A0%B4%E8%A7%A3.png" alt="ç ´è§£"></p>
<p><a href="http://idea.iteblog.com/key.php" target="_blank" rel="external">http://idea.iteblog.com/key.php</a></p>
<h3 id="u9879_u76EE_u5F15_u5165"><a href="#u9879_u76EE_u5F15_u5165" class="headerlink" title="é¡¹ç›®å¼•å…¥"></a>é¡¹ç›®å¼•å…¥</h3><p>ç ´è§£ä»¥åï¼Œä¸€è·¯é»˜è®¤å¯åŠ¨èµ·æ¥ã€‚å…ˆåˆ›å»ºä¸ªProjectï¼ŒIntellijé‡Œé¢çš„projectç›¸å½“äºworkplaceï¼Œå¯ä»¥å…ˆå»ºä¸€ä¸ªç©ºçš„projectçš„ï¼Œå°†é¡¹ç›®ä»£ç æ£€å‡ºåˆ°projecté‡Œé¢ï¼ˆä¹Ÿå¯ä»¥å°†åŸæœ‰çš„é¡¹ç›®copyåˆ°projectæ–‡ä»¶å¤¹ä¸‹ï¼Œå¦‚æœä¸æƒ³copyï¼Œç›´æ¥importä¹Ÿå¯ä»¥ï¼‰ï¼Œç„¶ååœ¨é‡Œé¢import module</p>
<p>æ£€å‡ºä»£ç åçš„æ•ˆæœï¼š<br><img src="http://7xpk5e.com1.z0.glb.clouddn.com/checkout.png" alt="intellij-checkout"></p>
<p>importåçš„æ•ˆæœï¼š<br><img src="http://7xpk5e.com1.z0.glb.clouddn.com/import1.png" alt="import1"><br><img src="http://7xpk5e.com1.z0.glb.clouddn.com/import2.png" alt="import2"><br><img src="http://7xpk5e.com1.z0.glb.clouddn.com/import3.png" alt="import3"><br><img src="http://7xpk5e.com1.z0.glb.clouddn.com/import4.png" alt="import4"></p>
<h3 id="u914D_u7F6E"><a href="#u914D_u7F6E" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>intellijçš„æ‰€æœ‰é…ç½®ä¿¡æ¯éƒ½åœ¨ File-&gt;Settingsé‡Œé¢ï¼Œè¯·è‡ªè¡Œæ‘¸ç´¢ã€‚</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/settings.png" alt="intellij-settings"></p>
<p>è¿™é‡Œè¯´è¯´å¸¸ç”¨çš„å‡ ä¸ªé…ç½®åœ¨å“ªé‡Œã€‚</p>
<p>1ã€é¡¹ç›®ç»“æ„</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/structure1.png" alt="structure1"></p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/structure2.png" alt="structure2"><br>è¿™é‡Œé¢å¯ä»¥é…ç½®moduleçš„è¯­è¨€ç‰ˆæœ¬ï¼Œæ·»åŠ jdkï¼Œjarå¼•å…¥ç­‰</p>
<p>2ã€maven</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/maven1.png" alt="maven1"></p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/maven2.png" alt="maven2"></p>
<p>3ã€Server</p>
<p>ä»¥tomcatä¸ºä¾‹</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/Server1.png" alt="tomcat1"></p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/Server2.png" alt="tomcat2"></p>
<p>é…ç½®å¥½Serverçš„åŸºæœ¬ä¿¡æ¯ï¼Œå®Œæˆè¿™ä¸€æ­¥ä¿å­˜ï¼Œç„¶åæ·»åŠ å…·ä½“çš„Server</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/Server3.png" alt="tomcat3"></p>
<p>æ·»åŠ æœ¬åœ°Serverï¼ŒServeræ ‡ç­¾é¡µæ›´æ”¹ç«¯å£ç­‰é…ç½®ä¿¡æ¯</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/Server4.png" alt="tomcat4"></p>
<p>Deploymenté‡Œé¢éƒ¨ç½²waråŒ…ï¼Œç‚¹å‡»åŠ å·ï¼Œé€‰æ‹©</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/Server5.png" alt="tomcat5"></p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/Server6.png" alt="tomcat6"></p>
<h3 id="u5916_u89C2_u5B57_u4F53_u6837_u5F0F_u4FEE_u6539"><a href="#u5916_u89C2_u5B57_u4F53_u6837_u5F0F_u4FEE_u6539" class="headerlink" title="å¤–è§‚å­—ä½“æ ·å¼ä¿®æ”¹"></a>å¤–è§‚å­—ä½“æ ·å¼ä¿®æ”¹</h3><p>é€šè¿‡File-&gt;Import Settingå¯ä»¥ç›´æ¥å¯¼å…¥Intellijçš„é…ç½®ä¿¡æ¯ã€‚æˆ‘è¿™é‡Œæœ‰ä¸ªjaråŒ…ï¼Œç›´æ¥å¯¼å…¥å³å¯</p>
<p>jaråœ°å€ï¼š<a href="https://pan.baidu.com/s/1kU6DxZL" target="_blank" rel="external">https://pan.baidu.com/s/1kU6DxZL</a></p>
<p>å¯¼å…¥é‡å¯å³å¯ï¼Œè°ƒæ•´äº†å­—ä½“å¤§å°ï¼Œæ–‡ä»¶æ³¨é‡Šæ¨¡æ¿ï¼Œé»˜è®¤UTF-8ï¼Œä½¿ç”¨äº†sublimeç±»ä¼¼çš„ä¸»é¢˜ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>Windowsä¸‹è½½åœ°å€ï¼š<a href="https://www.jetbrains.com/idea/]]>
    </summary>
    
      <category term="IntelliJ" scheme="http://suqun.github.io/tags/IntelliJ/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[git å¸¸ç”¨å‘½ä»¤]]></title>
    <link href="http://suqun.github.io/2016/10/18/gitcommands/"/>
    <id>http://suqun.github.io/2016/10/18/gitcommands/</id>
    <published>2016-10-18T08:38:01.000Z</published>
    <updated>2016-10-18T08:53:34.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u57FA_u672C_u547D_u4EE4"><a href="#u57FA_u672C_u547D_u4EE4" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h3><p>ä»£ç æ£€å‡ºï¼šgit clone åœ°å€</p>
<p>æ–‡ä»¶ä¿®æ”¹æ·»åŠ åˆ°æš‚å­˜åŒºï¼šgit add readme.txt </p>
<p>æ–‡ä»¶æäº¤ï¼šgit commit -m â€œå¤‡æ³¨â€ </p>
<p>æŸ¥çœ‹å·¥ä½œåŒºå½“å‰çŠ¶æ€ï¼šgit status</p>
<p>æŸ¥çœ‹å·®å¼‚ï¼šgit diff æ–‡ä»¶å</p>
<p>æŸ¥çœ‹å†å²ï¼šgit log â€“pretty=oneline</p>
<p>æŸ¥çœ‹å†å²æäº¤commit idï¼šgit log â€“pretty=oneline â€“abbrev-commit</p>
<p>æ¢å¤å½“å‰ç‰ˆæœ¬ï¼šgit reset â€“hard HEAD</p>
<p>æ¢å¤ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼šgit reset â€“hard HEAD^<br>ï¼ˆä¸Šä¸Šä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯HEAD^^ï¼Œå½“ç„¶å¾€ä¸Š100ä¸ªç‰ˆæœ¬å†™100ä¸ª^æ¯”è¾ƒå®¹æ˜“æ•°ä¸è¿‡æ¥ï¼Œæ‰€ä»¥å†™æˆHEAD~100ï¼‰</p>
<p>æ¢å¤æŒ‡å®šç‰ˆæœ¬ï¼šgit reset â€“hard 3628164</p>
<p>æŸ¥çœ‹å‘½ä»¤å†å²ï¼šgit reflog</p>
<p>æŸ¥çœ‹å·¥ä½œåŒºå’Œç‰ˆæœ¬åº“åŒºåˆ«ï¼šgit diff HEAD â€“ readme.txt</p>
<p>æ’¤é”€ä¿®æ”¹ï¼šgit checkout â€“ readme.txt</p>
<p>æ’¤é”€ç¼“å­˜åŒºæ–‡ä»¶ï¼šgit reset HEAD readme.txt</p>
<p>åˆ é™¤æ–‡ä»¶ï¼šgit rm test.txt</p>
<h3 id="u5206_u652F_u547D_u4EE4"><a href="#u5206_u652F_u547D_u4EE4" class="headerlink" title="åˆ†æ”¯å‘½ä»¤"></a>åˆ†æ”¯å‘½ä»¤</h3><p>æŸ¥çœ‹åˆ†æ”¯ï¼šgit branch</p>
<p>åˆ›å»ºåˆ†æ”¯ï¼šgit branch <name></name></p>
<p>åˆ‡æ¢åˆ†æ”¯ï¼šgit checkout <name></name></p>
<p>åˆ›å»º+åˆ‡æ¢åˆ†æ”¯ï¼šgit checkout -b <name></name></p>
<p>æ¨é€è¿œç¨‹åˆ†æ”¯ï¼šgit push origin <name></name></p>
<p>åˆ›å»ºè¿œç¨‹åˆ†æ”¯ï¼šgit checkout -b dev origin/dev</p>
<p>git checkout -b paytest_20151202_online origin/paytest_20151202_online</p>
<p>åˆå¹¶æŸåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ï¼šgit merge <name></name></p>
<p>åˆå¹¶åˆ†æ”¯ç¦ç”¨Fast forwardï¼šgit merge â€“no-ff -m â€œå¤‡æ³¨â€ dev</p>
<p>åˆ é™¤åˆ†æ”¯ï¼šgit branch -d <name></name></p>
<p>åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼šgit push origin â€“delete <branchname></branchname></p>
<p>å¼ºåˆ¶åˆ é™¤åˆ†æ”¯ï¼šgit branch -D <name></name></p>
<p>æŸ¥çœ‹åˆ†æ”¯å†å²ï¼šgit log â€“graph â€“pretty=oneline â€“abbrev-commit</p>
<p>åˆ†æ”¯åˆå¹¶å›¾ï¼šgit log â€“graph</p>
<p>å‚¨è—å·¥ä½œåŒºï¼šgit stash</p>
<p>æŸ¥çœ‹å‚¨è—çš„å·¥ä½œåŒºï¼šgit stash list</p>
<p>æ¢å¤å¹¶åˆ é™¤å‚¨è—å·¥ä½œåŒºï¼šgit stash pop</p>
<p>æ¢å¤æŒ‡å®šå·¥ä½œåŒºï¼šgit stash apply stash@{0}</p>
<p>æ¢å¤å‚¨è—å·¥ä½œåŒºï¼šgit stash apply</p>
<p>åˆ é™¤å‚¨è—å·¥ä½œåŒºï¼šgit stash drop</p>
<p>æŸ¥è¯¢è¿œç¨‹åº“è¯¦ç»†ä¿¡æ¯ï¼šgit remote -v</p>
<p>æ¨é€åˆ†æ”¯ï¼šgit push origin dev</p>
<p>æŠ“å–æœ€æ–°æ–‡ä»¶ï¼šgit pull åˆ†æ”¯å</p>
<p>å–è¿œç¨‹åˆ†æ”¯ï¼šgit pull origin åˆ†æ”¯å</p>
<p>æŒ‡å®šåˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯é“¾æ¥ï¼šgit branch â€“set-upstream dev origin/dev</p>
<h3 id="u6807_u7B7E_u547D_u4EE4"><a href="#u6807_u7B7E_u547D_u4EE4" class="headerlink" title="æ ‡ç­¾å‘½ä»¤"></a>æ ‡ç­¾å‘½ä»¤</h3><p>åˆ›å»ºæ ‡ç­¾ï¼šgit tag v1.0</p>
<p>åˆ é™¤æœ¬åœ°æ ‡ç­¾ï¼šgit tag -d v0.1</p>
<p>åˆ é™¤è¿œç¨‹æ ‡ç­¾ï¼šgit push origin :refs/tags0.9</p>
<p>åˆ é™¤è¿œç¨‹æ ‡ç­¾ï¼šgit push origin â€“delete tag <tagname></tagname></p>
<p>æŸ¥çœ‹æ ‡ç­¾ï¼šgit tag</p>
<p>æŒ‡å®šcommit idåˆ›å»ºæ ‡ç­¾ï¼šgit tag v0.9 6224937</p>
<p>æŒ‡å®šæ ‡ç­¾ä¿¡æ¯ï¼šgit tag -a <tagname> -m â€œblablablaâ€¦â€</tagname></p>
<p>å¯ä»¥ç”¨PGPç­¾åæ ‡ç­¾ï¼šgit tag -s <tagname> -m â€œblablablaâ€¦â€</tagname></p>
<p>æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯ï¼šgit show æ ‡ç­¾å</p>
<p>æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ï¼šgit push origin v1.0</p>
<p>æ¨é€æ‰€æœ‰æ ‡ç­¾åˆ°è¿œç¨‹ï¼šgit push origin â€“tags</p>
<h3 id="u5176_u4ED6"><a href="#u5176_u4ED6" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>é…ç½®åˆ«åï¼šgit config â€“global alias.st status</p>
<p>åœ¨Gitå·¥ä½œåŒºçš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„.gitignoreæ–‡ä»¶ï¼Œç„¶åæŠŠè¦å¿½ç•¥çš„æ–‡ä»¶åå¡«è¿›å»ï¼ŒGitå°±ä¼šè‡ªåŠ¨å¿½ç•¥è¿™äº›æ–‡ä»¶ã€‚</p>
<p>æ’¤éŠ·git add . =&gt; git rm -r â€“cached .</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u57FA_u672C_u547D_u4EE4"><a href="#u57FA_u672C_u547D_u4EE4" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h3><p>ä»£ç æ£€å‡ºï¼šgit clone åœ°å€</p>
<p]]>
    </summary>
    
      <category term="git" scheme="http://suqun.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[javaåº”ç”¨ç»“åˆJenkinsï¼Œdockeréƒ¨ç½²åˆ°Kubernetes]]></title>
    <link href="http://suqun.github.io/2016/10/17/docker-jenkins/"/>
    <id>http://suqun.github.io/2016/10/17/docker-jenkins/</id>
    <published>2016-10-17T08:44:51.000Z</published>
    <updated>2016-10-24T15:25:46.000Z</updated>
    <content type="html"><![CDATA[<h3 id="Jenkins_u5B89_u88C5"><a href="#Jenkins_u5B89_u88C5" class="headerlink" title="Jenkinså®‰è£…"></a>Jenkinså®‰è£…</h3><p>1ã€ä¸‹è½½Jenkins waråŒ…å®‰è£…ï¼Œä¸‹è½½åœ°å€ <a href="/jenkins.io">jenkins.io</a>ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯Jenkins2.24ç‰ˆæœ¬</p>
<p>2ã€å¯åŠ¨Jenkins</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JENKINS_HOME=~/.jenkins java -jar ~/Downloads/jenkins-<span class="number">2.24</span>.war --httpPort=<span class="number">9090</span></span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨åï¼Œæ—¥å¿—ä¼šæç¤º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*************************************************************&#10;*************************************************************&#10;*************************************************************&#10; &#10;Jenkins initial setup is required. An admin user has been created and a password generated.&#10;Please use the following password to proceed to installation:&#10; &#10;3521fbc3d40448efa8942f8e464b2dd9&#10; &#10;This may also be found at: /Users/arungupta/.jenkins/secrets/initialAdminPassword&#10; &#10;*************************************************************&#10;*************************************************************&#10;*************************************************************</span><br></pre></td></tr></table></figure></p>
<p>è®¿é—®localhost:9090ï¼Œè¾“å…¥ä¸Šé¢æç¤ºçš„å¯†ç ï¼Œç„¶åæ ¹æ®æç¤ºï¼Œå®‰è£…æ¨èçš„æ’ä»¶ï¼Œå¹¶åˆ›å»ºç”¨æˆ·</p>
<h3 id="Jenkins_u63D2_u4EF6_u5B89_u88C5"><a href="#Jenkins_u63D2_u4EF6_u5B89_u88C5" class="headerlink" title="Jenkinsæ’ä»¶å®‰è£…"></a>Jenkinsæ’ä»¶å®‰è£…</h3><p>1ã€mavené…ç½®<br>åœ¨ ç³»ç»Ÿç®¡ç†-&gt;Global Tool Configuration-&gt;Maven ä¸­é…ç½®Mavenä¿¡æ¯<br><img src="http://7xpk5e.com1.z0.glb.clouddn.com/jenkis-maven3.png" alt="maven3"></p>
<p>2ã€å…¶ä»–æ’ä»¶å®‰è£…<br>åœ¨ ç³»ç»Ÿç®¡ç†-&gt;ç®¡ç†æ’ä»¶-&gt;å¯é€‰æ’ä»¶ä¸­æœç´¢ docker pipe ï¼Œé€‰æ‹©CloudBees Docker Pipelineè¿›è¡Œå®‰è£…ï¼Œå®‰è£…åé‡å¯Jenkins</p>
<h3 id="u521B_u5EFAJenkins_u4EFB_u52A1"><a href="#u521B_u5EFAJenkins_u4EFB_u52A1" class="headerlink" title="åˆ›å»ºJenkinsä»»åŠ¡"></a>åˆ›å»ºJenkinsä»»åŠ¡</h3><p>æ–°å»ºä»»åŠ¡docker-pipeline</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/docker-pipeline.png" alt="docker-pipeline"></p>
<p>é€‰æ‹©Pipelineåï¼Œç‚¹å‡»Okåå¯¹ä»»åŠ¡è¿›è¡Œé…ç½®ã€‚é…ç½®é¡µä¸­ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦è¿›è¡Œè®¾ç½®ã€‚éƒ½æ¯”è¾ƒç®€å•ä¸€çœ‹å°±çŸ¥é“ã€‚æˆ‘è¿™é‡Œæµ‹è¯•çš„æ˜¯ä»£ç SCMä½¿ç”¨çš„SVNï¼Œå†Pipelineé¡¹é€‰æ‹©Pipeline script from scmè¿›è¡Œå¦‚ä¸‹è®¾ç½®</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/pipeline-from-scm.png" alt="pipeline-from-scm"></p>
<p>å…¶ä¸­script pathä¸­è®¾ç½®çš„Jenkinsfileä¸ºå…·ä½“çš„æ„å»ºæ­¥éª¤ï¼Œåœ¨é¡¹ç›®åœ°å€çš„ç›®å½•ä¸­ã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥é€‰æ‹© Pipeline scriptï¼Œç›´æ¥åœ¨è„šæœ¬ä¸­è®¾ç½®æ„å»ºæ­¥éª¤</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/pipeline-script.png" alt="pipeline-script"></p>
<p>è„šæœ¬ä¸­ä¸»è¦çš„å°±æ˜¯æ„å»ºæ­¥éª¤ï¼Œä»scmæ£€å‡ºé¡¹ç›®ï¼Œmvnæµ‹è¯•æ‰“åŒ…ï¼Œç”Ÿæˆdockeré•œåƒï¼Œå°†dockeré•œåƒä¸Šä¼ åˆ°é•œåƒä»“åº“ï¼Œç„¶åç™»å½•K8sçš„masterä¸Šï¼Œéƒ¨ç½²æ–°çš„é•œåƒåŒ…ã€‚</p>
<p>æ¥çœ‹çœ‹Jenkinsfileï¼Œé‡Œé¢æ˜¯å¦‚ä½•æè¿°ä¸Šé¢çš„æ­¥éª¤çš„ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node &#123;&#10;    checkout scm&#10;    env.PATH = &#34;$&#123;tool &#39;Maven3&#39;&#125;/bin:$&#123;env.PATH&#125;&#34;&#10;    stage(&#39;Package&#39;) &#123;&#10;        dir(&#39;RpcServerSample&#39;) &#123;&#10;            sh &#39;mvn clean package -DskipTests&#39;&#10;        &#125;&#10;    &#125;&#10;&#10;    stage(&#39;Run Tests&#39;) &#123;&#10;        dir(&#39;RpcServerSample&#39;) &#123;&#10;                sh &#34;mvn test&#34;&#10;        &#125;&#10;    &#125;&#10;&#10;    stage(&#39;Build Image&#39;) &#123;&#10;        dir(&#39;RpcServerSample&#39;) &#123;&#10;            docker.build(&#34;daocloud.io/suqun/docker-jenkins-pipeline:v1&#34;).push()&#10;        &#125;&#10;    &#125;&#10;&#10;    stage(&#39;Deploy&#39;) &#123;&#10;        //&#26367;&#25442;rpcserver.yaml&#30340;&#38236;&#20687;&#29256;&#26412;&#21495;&#65292;&#24453;&#23436;&#25104;&#10;&#10;        dir(&#39;RpcServerSample&#39;) &#123;&#10;            //scp rpcserver.yaml &#21040; k8s&#30340;master&#19978;&#10;            sh &#39;sshpass -p vagrant scp rpcserver.yaml vagrant@192.168.1.10:/home/vagrant/rpcserver.yaml&#39;&#10;&#10;            //&#36828;&#31243;&#30331;&#24405;k8s&#38598;&#32676;master&#20027;&#26426;,&#26356;&#26032;&#38236;&#20687;&#65292;&#36825;&#37324;&#38754;&#35201;&#36827;&#34892;&#21028;&#26029;&#65292;&#31532;&#19968;&#27425;create&#10;            sh &#39;sshpass -p vagrant ssh vagrant@192.168.1.10 &#34;kubectl create -f /home/vagrant/rpcserver.yaml&#34;&#39;&#10;        &#125;&#10;    &#125;&#10;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>docker.buildè¯­å¥é€šè¿‡RpcServerSampleè·¯å¾„ä¸‹çš„Dockerfileåˆ›å»ºé•œåƒ</p>
<p>Dockerfile<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM daocloud.io/java:<span class="number">7</span></span><br><span class="line">MAINTAINER <span class="string">"Larry Su &lt;larrys@wicresoft.com&gt;"</span></span><br><span class="line">ADD target/RpcServerSample-<span class="number">1.0</span>-SNAPSHOT-jar-with-dependencies.jar /usr/src/myapp/RpcServerSample.jar</span><br><span class="line">WORKDIR /usr/src/myapp</span><br><span class="line">CMD [<span class="string">"java"</span>,<span class="string">"-jar"</span>, <span class="string">"RpcServerSample.jar"</span>]</span><br></pre></td></tr></table></figure></p>
<p>rpcserver.yamlæ˜¯K8sä¸­çš„Deploymentå’ŒService</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1&#10;kind: Service&#10;metadata:&#10;  name: rpcserversample&#10;  labels:&#10;    app: rpcserversample&#10;spec:&#10;  # if your cluster supports it, uncomment the following to automatically create&#10;  # an external load-balanced IP for the frontend service.&#10;  #type: NodePort&#10;  ports:&#10;    # the port that this service should serve on&#10;  - port: 9001&#10;  selector:&#10;    app: rpcserversample&#10;---&#10;apiVersion: extensions/v1beta1&#10;kind: Deployment&#10;metadata:&#10;  name: rpcserversample&#10;  # these labels can be applied automatically&#10;  # from the labels in the pod template if not set&#10;  labels:&#10;    app: rpcserversample&#10;spec:&#10;  # this replicas value is default&#10;  # modify it according to your case&#10;  replicas: 2&#10;  # selector can be applied automatically&#10;  # from the labels in the pod template if not set&#10;  # selector:&#10;  #   matchLabels:&#10;  #     app: guestbook&#10;  #     tier: frontend&#10;  template:&#10;    metadata:&#10;      labels:&#10;        app: rpcserversample&#10;    spec:&#10;      containers:&#10;      - name: rpcserversample&#10;        image: daocloud.io/suqun/rpcserversample:v1&#10;        resources:&#10;          requests:&#10;            cpu: 100m&#10;            memory: 100Mi&#10;        ports:&#10;        - containerPort: 80</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰äº›Jenkins pipelineæœ€ä½³å®è·µï¼Œå¯ä»¥å‚è€ƒ:<a href="http://www.weixinla.com/document/41174312.html" target="_blank" rel="external">Jenkinsç®¡é“æœ€ä½³å®è·µTop 10</a></p>
<p>è„šæœ¬å†™çš„æ¯”è¾ƒçƒ‚ï¼Œåªæ˜¯å¤§æ¦‚çš„æµç¨‹ï¼Œå¾…å®Œå–„ã€‚</p>
<h3 id="u6784_u5EFA"><a href="#u6784_u5EFA" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><p>è¿›å…¥ä»»åŠ¡ï¼Œç‚¹å‡»ç«‹å³æ„å»ºåç»“æœå¦‚ä¸‹</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/Jenkins-build.png" alt="result"></p>
<p>ç„¶åå¯ä»¥ç™»å½•K8sé›†ç¾¤çš„masterä¸»æœºï¼Œé€šè¿‡<code>kubectl get po,svc</code> æ£€æŸ¥æ˜¯å¦éƒ¨ç½²æˆåŠŸã€‚</p>
<p>å‚è€ƒï¼š<a href="https://dzone.com/articles/deployment-pipeline-using-docker-jenkins-java-and" target="_blank" rel="external">Deployment Pipeline Using Docker, Jenkins, Java, and Couchbase</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="Jenkins_u5B89_u88C5"><a href="#Jenkins_u5B89_u88C5" class="headerlink" title="Jenkinså®‰è£…"></a>Jenkinså®‰è£…</h3><p>1ã€ä¸‹è½½Jenkins waråŒ…å®‰è£…ï¼Œä¸‹è½½åœ°]]>
    </summary>
    
      <category term="Docker" scheme="http://suqun.github.io/tags/Docker/"/>
    
      <category term="Jenkins" scheme="http://suqun.github.io/tags/Jenkins/"/>
    
      <category term="K8s" scheme="http://suqun.github.io/tags/K8s/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ä½¿ç”¨kubeadmåœ¨CentOS7ä¸Šå®‰è£…Kubernetesé›†ç¾¤]]></title>
    <link href="http://suqun.github.io/2016/09/27/dockerjavamicroservice4/"/>
    <id>http://suqun.github.io/2016/09/27/dockerjavamicroservice4/</id>
    <published>2016-09-27T02:52:03.000Z</published>
    <updated>2016-10-24T15:23:42.000Z</updated>
    <content type="html"><![CDATA[<p>Kubernetes1.4ç‰ˆæœ¬æä¾›kubeadmå‘½ä»¤è¿›è¡Œç®€åŒ–k8sé›†ç¾¤çš„å®‰è£…ï¼Œåªè¦ä½¿ç”¨2ä¸ªç®€å•å‘½ä»¤å°±å¯ä»¥å®Œæˆå®‰è£…ã€‚ å®‰è£…kubernetesä»¥åï¼Œä½¿ç”¨<code>kubeadm init</code>å¯åŠ¨masterï¼Œä½¿ç”¨<code>kubeadm joins</code>æŠŠnodeæ·»åŠ åˆ°é›†ç¾¤é‡Œã€‚ä¸‹é¢æ˜¯æ ¹æ®å®˜æ–¹åšå®¢<a href="http://kubernetes.io/docs/getting-started-guides/kubeadm/" target="_blank" rel="external">Installing Kubernetes on Linux with kubeadm</a>ç»ƒä¹ çš„è®°å½•ã€‚</p>
<h4 id="u4F7F_u7528vagrant_u521B_u5EFA_u4E24_u4E2Acentos7"><a href="#u4F7F_u7528vagrant_u521B_u5EFA_u4E24_u4E2Acentos7" class="headerlink" title="ä½¿ç”¨vagrantåˆ›å»ºä¸¤ä¸ªcentos7"></a>ä½¿ç”¨vagrantåˆ›å»ºä¸¤ä¸ªcentos7</h4><p>åœ¨k8s-centos7-clusteræ–‡ä»¶å¤¹ä¸‹åˆ›å»ºVagrantfileæ–‡ä»¶ã€‚Vagrantfileé…ç½®å¦‚ä¸‹ï¼š<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: ruby -*-</span></span><br><span class="line"><span class="comment"># vi: set ft=ruby :</span></span><br><span class="line"></span><br><span class="line">boxes = [</span><br><span class="line">  &#123; <span class="symbol">:name</span> =&gt; <span class="symbol">:master</span>,<span class="symbol">:ip</span> =&gt; <span class="string">'192.168.1.20'</span>,<span class="symbol">:forward</span> =&gt; <span class="number">80</span>,<span class="symbol">:cpus</span> =&gt; <span class="number">1</span>,<span class="symbol">:mem</span> =&gt; <span class="number">1024</span>&#125;,</span><br><span class="line">  &#123; <span class="symbol">:name</span> =&gt; <span class="symbol">:node1</span>,<span class="symbol">:ip</span> =&gt; <span class="string">'192.168.1.21'</span>,<span class="symbol">:forward</span> =&gt; <span class="number">80</span>,<span class="symbol">:cpus</span> =&gt; <span class="number">1</span>,<span class="symbol">:mem</span> =&gt; <span class="number">1024</span>&#125;,</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line"><span class="constant">VAGRANTFILE_API_VERSION</span> = <span class="string">"2"</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Vagrant</span>.configure(<span class="constant">VAGRANTFILE_API_VERSION</span>) <span class="keyword">do</span> |config|</span><br><span class="line">    boxes.each <span class="keyword">do</span> |opts|</span><br><span class="line">        config.vm.define opts[<span class="symbol">:name</span>] <span class="keyword">do</span> |config|</span><br><span class="line">            config.vm.box       = <span class="string">"centos7"</span></span><br><span class="line">            config.vm.boot_timeout = <span class="number">360</span></span><br><span class="line">            config.ssh.username = <span class="string">"vagrant"</span></span><br><span class="line">            config.ssh.password = <span class="string">"vagrant"</span></span><br><span class="line">            config.vm.synced_folder <span class="string">"."</span>, <span class="string">"/vagrant"</span>, <span class="symbol">disabled:</span><span class="keyword">true</span></span><br><span class="line">            config.vm.network  <span class="string">"public_network"</span>, <span class="symbol">ip:</span> opts[<span class="symbol">:ip</span>]</span><br><span class="line">            <span class="comment">#config.vm.network "forwarded_port", guest: 80, host: 8080</span></span><br><span class="line">            config.vm.hostname = <span class="string">"%s.vagrant"</span> % opts[<span class="symbol">:name</span>].to_s</span><br><span class="line">            config.vm.provider <span class="string">"virtualbox"</span> <span class="keyword">do</span> |vb|</span><br><span class="line">                vb.customize [<span class="string">"modifyvm"</span>, <span class="symbol">:id</span>, <span class="string">"--cpus"</span>, opts[<span class="symbol">:cpus</span>] ] <span class="keyword">if</span> opts[<span class="symbol">:cpus</span>]</span><br><span class="line">                vb.customize [<span class="string">"modifyvm"</span>, <span class="symbol">:id</span>, <span class="string">"--memory"</span>, opts[<span class="symbol">:mem</span>] ] <span class="keyword">if</span> opts[<span class="symbol">:mem</span>]</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="comment">#config.vm.provision "shell", inline: $update_script</span></span><br><span class="line">            <span class="comment">#config.vm.provision "shell", path: opts[:provision] if opts[:provision]</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>åœ¨Vagrantfileæ–‡ä»¶ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸¤ä¸ªCentOS7ç³»ç»Ÿï¼Œä¸€ä¸ªä½œä¸ºmasterï¼Œä¸€ä¸ªä½œä¸ºnode<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  k8s-centos7-cluster vagrant up</span><br><span class="line">Bringing machine <span class="string">'master'</span> up with <span class="string">'virtualbox'</span> provider...</span><br><span class="line">Bringing machine <span class="string">'node1'</span> up with <span class="string">'virtualbox'</span> provider...</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>Okï¼Œä¸‹é¢æˆ‘ä»¬å¼€å§‹åœ¨CentOS7ä¸­å®‰è£…k8sé›†ç¾¤</p>
<h4 id="u5B89_u88C5kubelet_u548Ckuebadm"><a href="#u5B89_u88C5kubelet_u548Ckuebadm" class="headerlink" title="å®‰è£…kubeletå’Œkuebadm"></a>å®‰è£…kubeletå’Œkuebadm</h4><p>åœ¨æ‰€æœ‰çš„æœºå­ä¸Šéƒ½å¿…é¡»å®‰è£…dockerï¼Œkubeletï¼Œkubectlï¼Œkubeadmï¼Œæ— è®ºæ˜¯masterè¿˜æ˜¯nodeã€‚å¹¶ä¸”ä½¿ç”¨rootæƒé™è¿›è¡Œå®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ  k8s-centos7-cluster vagrant ssh master <span class="comment">#è¾“å…¥å¯†ç ç™»å½•master</span></span><br><span class="line">[vagrant@master ~]$ </span><br><span class="line">[vagrant@master ~]$ sudo su -</span><br></pre></td></tr></table></figure>
<p>ç™»å½•masterï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cat &#60;&#60;EOF &#62; /etc/yum.repos.d/k8s.repo&#10;[kubelet]&#10;name=kubelet&#10;baseurl=http://files.rm-rf.ca/rpms/kubelet/&#10;enabled=1&#10;gpgcheck=0&#10;EOF&#10;# yum install docker kubelet kubeadm kubectl kubernetes-cni&#10;# systemctl enable docker &#38;&#38; systemctl start docker&#10;# systemctl enable kubelet &#38;&#38; systemctl start kubelet</span><br></pre></td></tr></table></figure>
<p>ç­‰å¾…ä¸‹è½½åå®‰è£…ã€‚<br>å®‰è£…å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨<code>systemctl status</code> æŸ¥çœ‹å®‰è£…å¥½çš„ç»„ä»¶æœåŠ¡çŠ¶æ€ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># systemctl status docker</span></span><br><span class="line">â— docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Tue <span class="number">2016</span>-<span class="number">09</span>-<span class="number">27</span> <span class="number">04</span>:<span class="number">57</span>:<span class="number">44</span> UTC; <span class="number">41</span>s ago</span><br></pre></td></tr></table></figure>
<h4 id="u521D_u59CB_u5316master"><a href="#u521D_u59CB_u5316master" class="headerlink" title="åˆå§‹åŒ–master"></a>åˆå§‹åŒ–master</h4><p>åœ¨masterä¸Šè¿è¡Œæ§åˆ¶ç»„ä»¶ï¼ŒåŒ…å«etcdï¼ˆé›†ç¾¤çš„æ•°æ®åº“ï¼‰ï¼ŒAPI serverï¼ˆkubectl å®¢æˆ·ç«¯æ²Ÿé€šç”¨ï¼‰ã€‚è¿™äº›ç»„ä»¶éƒ½åœ¨podä¸­é€šè¿‡kubeletå¯åŠ¨è¿è¡Œã€‚<br>åˆå§‹åŒ–masterï¼Œé€‰æ‹©ä¸Šé¢å®ç°å®‰è£…è¿‡kubeletå’Œkubeadmçš„ä¸»æœºï¼Œç„¶åè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># kubeadm init --use-kubernetes-version v1.4.0-beta.11</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œåï¼Œä¼šä¸‹è½½å®‰è£…é›†ç¾¤ç”¨çš„æ•°æ®åº“å’Œæ§åˆ¶ç»„ä»¶ï¼Œéœ€è¦ç­‰å¾…ä¸€äº›æ—¶é—´ï¼Œè¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;master/tokens&gt; generated token: <span class="string">"88958f.2068ff49c1675f8c"</span></span><br><span class="line">&lt;master/pki&gt; created keys and certificates <span class="keyword">in</span> <span class="string">"/etc/kubernetes/pki"</span></span><br><span class="line">&lt;util/kubeconfig&gt; created <span class="string">"/etc/kubernetes/kubelet.conf"</span></span><br><span class="line">&lt;util/kubeconfig&gt; created <span class="string">"/etc/kubernetes/admin.conf"</span></span><br><span class="line">&lt;master/apiclient&gt; created API client configuration</span><br><span class="line">&lt;master/apiclient&gt; created API client, waiting <span class="keyword">for</span> the control plane to become ready</span><br></pre></td></tr></table></figure>
<p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Kubernetes1.4ç‰ˆæœ¬æä¾›kubeadmå‘½ä»¤è¿›è¡Œç®€åŒ–k8sé›†ç¾¤çš„å®‰è£…ï¼Œåªè¦ä½¿ç”¨2ä¸ªç®€å•å‘½ä»¤å°±å¯ä»¥å®Œæˆå®‰è£…ã€‚ å®‰è£…kubernetesä»¥åï¼Œä½¿ç”¨<code>kubeadm init</code>å¯åŠ¨masterï¼Œä½¿ç”¨<code>kubeadm joins</code>]]>
    </summary>
    
      <category term="Docker" scheme="http://suqun.github.io/tags/Docker/"/>
    
      <category term="K8s" scheme="http://suqun.github.io/tags/K8s/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[åŸºäºDockerçš„javaå¾®æœåŠ¡(ä¸‰) KubernetesæœåŠ¡å‘ç°ä¹‹ç¯å¢ƒå˜é‡]]></title>
    <link href="http://suqun.github.io/2016/09/26/dockerjavamicroservice3/"/>
    <id>http://suqun.github.io/2016/09/26/dockerjavamicroservice3/</id>
    <published>2016-09-26T09:14:49.000Z</published>
    <updated>2016-10-24T15:23:40.000Z</updated>
    <content type="html"><![CDATA[<ol>
<li>åˆ›å»ºä¸¤ä¸ªæœåŠ¡</li>
<li>å°†æœåŠ¡æ‰“åŒ…æˆé•œåƒ</li>
<li>k8sçš„service</li>
<li>k8sçš„deployment</li>
<li>ç®€å•æµ‹è¯•</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<ol>
<li>åˆ›å»ºä¸¤ä¸ªæœåŠ¡</li>
<li>å°†æœåŠ¡æ‰“åŒ…æˆé•œåƒ</li>
<li>k8sçš„service</li>
<li>k8sçš„deployment</li>
<li>ç®€å•æµ‹è¯•</li>
</ol>
]]>
    </summary>
    
      <category term="Docker" scheme="http://suqun.github.io/tags/Docker/"/>
    
      <category term="K8s" scheme="http://suqun.github.io/tags/K8s/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[åŸºäºDockerçš„javaå¾®æœåŠ¡(äºŒ) CentOS7éƒ¨ç½²Kubernetesé›†ç¾¤]]></title>
    <link href="http://suqun.github.io/2016/09/07/dockerjavamicroservice2/"/>
    <id>http://suqun.github.io/2016/09/07/dockerjavamicroservice2/</id>
    <published>2016-09-07T11:23:15.000Z</published>
    <updated>2016-10-24T15:23:39.000Z</updated>
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦å‚è€ƒç¾å›¢äº‘çš„<a href="https://mos.meituan.com/library/37/how-to-setup-k8s-cluster-on-CentOS7/" target="_blank" rel="external">åœ¨CentOS7ä¸Šéƒ¨ç½²Kubernetesé›†ç¾¤</a></p>
<h3 id="u6982_u8FF0"><a href="#u6982_u8FF0" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Kubernetes(k8s)æ˜¯Googleå¼€æºçš„å¤§è§„æ¨¡å®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿ, æœ¬æ–‡å°†åŸºäºCentOS7è‡ªå¸¦çš„Kubernetesç»„ä»¶ã€åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿetcdä»¥åŠFlannelå®ç°çš„overlayç½‘ç»œæ¥æ­å»ºä¸€ä¸ªç®€å•çš„k8sé›†ç¾¤ã€‚</p>
<h3 id="vagrant_u5B89_u88C5_u591A_u53F0CentOS7"><a href="#vagrant_u5B89_u88C5_u591A_u53F0CentOS7" class="headerlink" title="vagrantå®‰è£…å¤šå°CentOS7"></a>vagrantå®‰è£…å¤šå°CentOS7</h3><p>ä½¿ç”¨vagrantåˆ›å»ºå¤šä¸ªCentOS7è™šæ‹Ÿæœºç”¨äºé›†ç¾¤éƒ¨ç½²ã€‚vagrantçš„å®‰è£…éå¸¸ç®€å•,ç½‘ä¸Šä¸€å¤§å †æ•™ç¨‹ï¼Œå¯ä»¥å‚è€ƒ<a href="http://www.tuicool.com/articles/miE7vm6" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯1.8.5ç‰ˆæœ¬ã€‚åŒæ—¶è¿˜éœ€è¦ä¸‹è½½CentOSçš„boxæ–‡ä»¶,<br>ç”±äºboxæ–‡ä»¶éƒ½åœ¨å›½å¤–çš„ç½‘ç«™ä¸Šä¸‹è½½é€Ÿåº¦ç¼“æ…¢,å¯ä»¥ä»æˆ‘çš„äº‘ç›˜ä¸Šä¸‹è½½<a href="https://pan.baidu.com/s/1jI6T4EE" target="_blank" rel="external">CentOS-7-x86_64-Minimal-1511.box</a>ã€‚<br>æœ‰äº†boxæ–‡ä»¶å,æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ·»åŠ box</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant add box CentOS-<span class="number">7</span>-x86_64-Minimal-<span class="number">1511</span>.box</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹vagrantå·²æ·»åŠ çš„box</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant box list</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºå•å°CentOSå¾ˆç®€å•ï¼Œéœ€è¦ä¸‹é¢çš„æ­¥éª¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkidr centos7</span><br><span class="line"><span class="built_in">cd</span> centos7</span><br><span class="line">vagrant init</span><br><span class="line">vagrant up</span><br></pre></td></tr></table></figure>
<p>vagrant initä¼šåˆå§‹åŒ–ä¸€ä¸ªVagrantfileçš„æ–‡ä»¶ï¼ŒCentOSçš„é…ç½®éƒ½æ˜¯è¿™ä¸ªæ–‡ä»¶è®¾å®šçš„ã€‚è¿™é‡Œç»™å‡ºåˆ›å»ºå¤šå°centosçš„Vagrantfileé…ç½®ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: ruby -*-</span></span><br><span class="line"><span class="comment"># vi: set ft=ruby :</span></span><br><span class="line"></span><br><span class="line">boxes = [</span><br><span class="line">  &#123; <span class="symbol">:name</span> =&gt; <span class="symbol">:master</span>,<span class="symbol">:ip</span> =&gt; <span class="string">'192.168.253.7'</span>,<span class="symbol">:cpus</span> =&gt; <span class="number">1</span>,<span class="symbol">:mem</span> =&gt; <span class="number">1024</span>&#125;,</span><br><span class="line">  &#123; <span class="symbol">:name</span> =&gt; <span class="symbol">:worker1</span>,<span class="symbol">:ip</span> =&gt; <span class="string">'192.168.253.8'</span>,<span class="symbol">:cpus</span> =&gt; <span class="number">1</span>,<span class="symbol">:mem</span> =&gt; <span class="number">1024</span>&#125;,</span><br><span class="line">  &#123; <span class="symbol">:name</span> =&gt; <span class="symbol">:worker2</span>,<span class="symbol">:ip</span> =&gt; <span class="string">'192.168.253.9'</span>,<span class="symbol">:cpus</span> =&gt; <span class="number">1</span>,<span class="symbol">:mem</span> =&gt; <span class="number">1024</span>&#125;,</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line"><span class="constant">VAGRANTFILE_API_VERSION</span> = <span class="string">"2"</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Vagrant</span>.configure(<span class="constant">VAGRANTFILE_API_VERSION</span>) <span class="keyword">do</span> |config|</span><br><span class="line">    boxes.each <span class="keyword">do</span> |opts|</span><br><span class="line">        config.vm.define opts[<span class="symbol">:name</span>] <span class="keyword">do</span> |config|</span><br><span class="line">            config.vm.box       = <span class="string">"centos7"</span></span><br><span class="line">            config.vm.boot_timeout = <span class="number">360</span></span><br><span class="line">            config.ssh.username = <span class="string">"vagrant"</span></span><br><span class="line">            config.ssh.password = <span class="string">"vagrant"</span></span><br><span class="line">            config.vm.synced_folder <span class="string">"."</span>, <span class="string">"/vagrant"</span>, <span class="symbol">disabled:</span><span class="keyword">true</span></span><br><span class="line">            config.vm.network  <span class="string">"public_network"</span>, <span class="symbol">ip:</span> opts[<span class="symbol">:ip</span>]</span><br><span class="line">            config.vm.hostname = <span class="string">"%s.vagrant"</span> % opts[<span class="symbol">:name</span>].to_s</span><br><span class="line">            config.vm.provider <span class="string">"virtualbox"</span> <span class="keyword">do</span> |vb|</span><br><span class="line">                vb.customize [<span class="string">"modifyvm"</span>, <span class="symbol">:id</span>, <span class="string">"--cpus"</span>, opts[<span class="symbol">:cpus</span>] ] <span class="keyword">if</span> opts[<span class="symbol">:cpus</span>]</span><br><span class="line">                vb.customize [<span class="string">"modifyvm"</span>, <span class="symbol">:id</span>, <span class="string">"--memory"</span>, opts[<span class="symbol">:mem</span>] ] <span class="keyword">if</span> opts[<span class="symbol">:mem</span>]</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="comment">#config.vm.provision "shell", inline: $update_script</span></span><br><span class="line">            <span class="comment">#config.vm.provision "shell", path: opts[:provision] if opts[:provision]</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªæ–‡ä»¶çš„ç›®å½•ä¸‹æ‰§è¡Œ<code>vagrant up</code>å°±å¯ä»¥åˆ›å»º3å°è™šæ‹Ÿæœºã€‚æˆ‘ä»¬æŠŠå…¶ä¸­masterä½œä¸ºk8sçš„MasterèŠ‚ç‚¹ï¼Œworker1ï¼Œworker2ä½œä¸ºk8sçš„NodeèŠ‚ç‚¹æ¥åˆ›å»ºk8sé›†ç¾¤ã€‚</p>
<h3 id="u73AF_u5883_u51C6_u5907"><a href="#u73AF_u5883_u51C6_u5907" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><table>
<thead>
<tr>
<th>master</th>
<th style="text-align:center">worker1</th>
<th style="text-align:center">worker2</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.253.7</td>
<td style="text-align:center">192.168.253.8</td>
<td style="text-align:center">192.168.253.9</td>
</tr>
<tr>
<td>kubernetes</td>
<td style="text-align:center">ntpd</td>
<td style="text-align:center">ntpd</td>
</tr>
<tr>
<td>etcd</td>
<td style="text-align:center">flannel</td>
<td style="text-align:center">flannel</td>
</tr>
<tr>
<td>ntpd</td>
<td style="text-align:center">kubernetes</td>
<td style="text-align:center">kubernetes</td>
</tr>
</tbody>
</table>
<p>MasterèŠ‚ç‚¹ç¦ç”¨CentOS7è‡ªå¸¦é˜²ç«å¢™ï¼Œå®‰è£…kubernetesã€etcdã€ntpdç­‰è½¯ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop firewalld &amp;&amp; sudo systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">sudo yum install -y kubernetes etcd ntp.x86_64</span><br></pre></td></tr></table></figure>
<p>NodeèŠ‚ç‚¹åŒæ ·ç¦ç”¨CentOS7è‡ªå¸¦é˜²ç«å¢™ï¼Œå®‰è£…kubernetesã€flannelã€ntpdç­‰è½¯ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop firewalld &amp;&amp; sudo systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">sudo yum install -y ntp.x86_64 flannel kubernetes</span><br></pre></td></tr></table></figure>
<h3 id="Master_u914D_u7F6E"><a href="#Master_u914D_u7F6E" class="headerlink" title="Masteré…ç½®"></a>Masteré…ç½®</h3><p>ä¿®æ”¹etcdé…ç½®<code>/etc/etcd/etcd.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">"http://0.0.0.0:2379"</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹kuberneteså…¨å±€é…ç½®<code>/etc/kubernetes/config</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KUBE_LOG_LEVEL=<span class="string">"--v=2"</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹kubernetes apiserverçš„é…ç½®<code>/etc/kubernetes/apiserver</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KUBE_API_ADDRESS=<span class="string">"--address=0.0.0.0"</span></span><br><span class="line">KUBE_API_PORT=<span class="string">"--port=8080"</span></span><br><span class="line">KUBELET_PORT=<span class="string">"--kubelet_port=10250"</span></span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨masterçš„ntpdã€etcdã€kube-apiserverã€kube-schedulerã€kube-controller-manageræœåŠ¡ï¼Œè®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼Œå¹¶æŸ¥çœ‹å¯åŠ¨åçš„çŠ¶æ€ã€‚å¦‚æœæ¯ä¸€ä¸ªæœåŠ¡éƒ½å¯åŠ¨æˆåŠŸï¼Œé‚£ä¹ˆsudo systemctl status $SRVæ˜¾ç¤ºçš„ä¿¡æ¯åˆ™åŒ…å«Active: active (running)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> SRV <span class="keyword">in</span> ntpd etcd kube-apiserver kube-scheduler kube-controller-manager;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sudo systemctl start <span class="variable">$SRV</span></span><br><span class="line">    sudo systemctl <span class="built_in">enable</span> <span class="variable">$SRV</span></span><br><span class="line">    sudo systemctl status <span class="variable">$SRV</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹etcdé…ç½®ï¼Œåœ¨è®¾å®šNodeä¸­flannelæ‰€ä½¿ç”¨çš„å­ç½‘èŒƒå›´ä¸º172.17.1.0~172.17.254.0ï¼ˆæ¯ä¸€ä¸ªNodeèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„flannelå­ç½‘ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">etcdctl mk /coreos.com/network/config <span class="string">'&#123;"Network":"172.17.0.0/16", "SubnetMin": "172.17.1.0", "SubnetMax": "172.17.254.0"&#125;'</span></span><br></pre></td></tr></table></figure>
<h3 id="Node_u914D_u7F6E"><a href="#Node_u914D_u7F6E" class="headerlink" title="Nodeé…ç½®"></a>Nodeé…ç½®</h3><p>ä¿®æ”¹NodeèŠ‚ç‚¹ä¸Šflannelçš„é…ç½®<code>/etc/sysconfig/</code>flanneldï¼Œè®¾å®šetcdçš„ç›¸å…³ä¿¡æ¯ï¼Œå…¶ä¸­192.168.253.7ä¸ºMasterçš„IPåœ°å€ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLANNEL_ETCD=<span class="string">"http://192.168.253.7:2379"</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹NodeèŠ‚ç‚¹kubernetesçš„å…¨å±€é…ç½®æ–‡ä»¶<code>/etc/kubernetes/config</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">KUBE_LOG_LEVEL=<span class="string">"--v=2"</span></span><br><span class="line">KUBE_MASTER=<span class="string">"--master=http://192.168.253.7:8080"</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹NodeèŠ‚ç‚¹ä¸Škubernetes kubeletçš„é…ç½®<code>/etc/kubernetes/kubelet</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">KUBELET_ADDRESS=<span class="string">"--address=0.0.0.0"</span></span><br><span class="line">KUBELET_PORT=<span class="string">"--port=10250"</span></span><br><span class="line">KUBELET_API_SERVER=<span class="string">"--api_servers=http://192.168.253.7:8080"</span></span><br><span class="line">KUBELET_HOSTNAME=<span class="string">""</span></span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨NodeèŠ‚ç‚¹ä¸Šçš„ç›¸å…³æœåŠ¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> SRV <span class="keyword">in</span> ntpd flanneld docker kube-proxy kubelet;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sudo systemctl start <span class="variable">$SRV</span></span><br><span class="line">    sudo systemctl <span class="built_in">enable</span> <span class="variable">$SRV</span></span><br><span class="line">    sudo systemctl status <span class="variable">$SRV</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>ç±»ä¼¼MasterèŠ‚ç‚¹ï¼Œå¦‚æœæ¯ä¸€ä¸ªæœåŠ¡éƒ½å¯åŠ¨æˆåŠŸï¼Œé‚£ä¹ˆsudo systemctl status $SRVæ˜¾ç¤ºçš„ä¿¡æ¯åˆ™åŒ…å«Active: active (running)ã€‚</p>
<p>é…ç½®æ­¥éª¤éƒ½æ˜¯å‚è€ƒ<a href="https://mos.meituan.com/library/37/how-to-setup-k8s-cluster-on-CentOS7/" target="_blank" rel="external">ç¾å›¢äº‘åœ¨CentOS7ä¸Šéƒ¨ç½²Kubernetesé›†ç¾¤</a>ã€‚<br>ä¸å·§çš„æ˜¯ï¼Œæˆ‘åœ¨è¿™ä¸€æ­¥ä¸ŠèŠ±äº†1å‘¨çš„æ—¶é—´ã€‚ã€‚ã€‚ã€‚NodeèŠ‚ç‚¹ä¸Šçš„flanneldå’ŒdockeræœåŠ¡æ­»æ´»èµ·ä¸èµ·æ¥ã€‚<br>é€šè¿‡<code>systemctl status flanneld</code>ï¼Œå‘ç°ä¸€ç›´æŠ¥é”™<code>Failed to retrieve network config</code>ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<p>ä¿®æ”¹NodeèŠ‚ç‚¹ä¸Šçš„flanneldé…ç½® <code>/etc/sysconfig/flanneld</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLANNEL_ETCD_KEY=<span class="string">"/coreos.com/network"</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åé‡æ–°å¯åŠ¨flanneldå’ŒdockeræœåŠ¡å³å¯ã€‚</p>
<h3 id="u6D4B_u8BD5"><a href="#u6D4B_u8BD5" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>åœ¨Masterä¸ŠæŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@master ~]$ kubectl get nodes</span><br><span class="line">NAME              STATUS    AGE</span><br><span class="line">worker1.vagrant   Ready     <span class="number">4</span>m</span><br><span class="line">worker2.vagrant   Ready     <span class="number">10</span>s</span><br></pre></td></tr></table></figure>
<p>åœ¨MasterèŠ‚ç‚¹æŸ¥çœ‹flannelå­ç½‘åˆ†é…æƒ…å†µ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@master ~]$ etcdctl ls /coreos.com/network/subnets</span><br><span class="line">/coreos.com/network/subnets/<span class="number">172.17</span>.<span class="number">29.0</span>-<span class="number">24</span></span><br></pre></td></tr></table></figure>
<h3 id="Guestbook_u90E8_u7F72_u5230k8s_u4E2D"><a href="#Guestbook_u90E8_u7F72_u5230k8s_u4E2D" class="headerlink" title="Guestbookéƒ¨ç½²åˆ°k8sä¸­"></a>Guestbookéƒ¨ç½²åˆ°k8sä¸­</h3><p><a href="https://github.com/kubernetes/kubernetes/blob/release-1.2/examples/guestbook/README.md" target="_blank" rel="external">Guestbook example</a></p>
<p>éƒ¨ç½²çš„è¿‡ç¨‹ä¸­é‡åˆ°2ä¸ªé—®é¢˜</p>
<ol>
<li><p>é€šè¿‡<code>kubectl create -f xxx.yaml</code>åˆ›å»ºpodæ˜¾ç¤ºæˆåŠŸï¼Œä½†æ˜¯é€šè¿‡ <code>kubectl get pod</code>å‘½ä»¤ç¡®æŸ¥è¯¢ä¸åˆ°ä»»ä½•podä¿¡æ¯ã€‚è§£å†³æ–¹æ¡ˆå¯ä»¥å‚è€ƒï¼š<a href="http://www.voidcn.com/blog/jinzhencs/article/p-5975011.html" target="_blank" rel="external"> kubenetesæ— æ³•åˆ›å»ºpod/åˆ›å»ºRCæ—¶æ— æ³•è‡ªåŠ¨åˆ›å»ºpodçš„é—®é¢˜</a></p>
</li>
<li><p>è§£å†³äº†ä¸Šé¢çš„é—®é¢˜åï¼Œå¯ä»¥getåˆ°podä¿¡æ¯ï¼Œä½†æ˜¯nodeèŠ‚ç‚¹é€šè¿‡æŸ¥è¯¢docker imageså¹¶æœªå‘ç°ä»»ä½•é•œåƒï¼ŒåŸå› æ˜¯å› ä¸ºå›½å†…çš„ç½‘ç»œé—®é¢˜ï¼Œæ— æ³•ä¸‹è½½åˆ°é•œåƒæ‰€è‡´ã€‚å¯ä»¥æ‰‹åŠ¨pull<br>é•œåƒï¼š<code>registry.access.redhat.com/rhel7/pod-infrastructure</code>ä»¥åŠä½ æ‰€éœ€çš„å…¶ä»–é•œåƒã€‚</p>
</li>
</ol>
<h3 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™é‡Œçš„é›†ç¾¤éƒ¨ç½²å‚è€ƒçš„æ˜¯ç¾å›¢äº‘åˆ†äº«çš„ã€‚éƒ½åªæ˜¯ç»ƒæ‰‹ç”¨çš„ã€‚</p>
<p>k8séƒ¨ç½²è¿˜å¯ä»¥æ›´ç®€å•ï¼Œä¸€é”®éƒ¨ç½²ã€‚ä½¿ç”¨vagrant+coreOsï¼Œå®‰è£…å®Œè™šæ‹Ÿæœºåï¼ŒMasterèŠ‚ç‚¹c1ä¼šè‡ªåŠ¨ä¸‹åœ¨k8sæ‰€éœ€çš„ç¯å¢ƒï¼Œå¥ˆä½•å¤§é™†çš„ç¨‹åºå‘˜æ¯”è¾ƒè‹¦é€¼ï¼Œæœ‰å¢™çš„å­˜åœ¨ã€‚åœ¨ç¿»å¢™çš„æƒ…å†µä¸‹å¯ä»¥å°è¯•ä¸€é”®éƒ¨ç½²k8sé›†ç¾¤ã€‚è¯¦æƒ…è¯·ç§»æ­¥<a href="https://coreos.com/kubernetes/docs/latest/kubernetes-on-vagrant.html" target="_blank" rel="external">è¦ç¿»æ‰èƒ½çœ‹çš„åˆ°</a>ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>æœ¬æ–‡ä¸»è¦å‚è€ƒç¾å›¢äº‘çš„<a href="https://mos.meituan.com/library/37/how-to-setup-k8s-cluster-on-CentOS7/" target="_blank" rel="external">åœ¨CentOS7ä¸Šéƒ¨ç½²Kub]]>
    </summary>
    
      <category term="Docker" scheme="http://suqun.github.io/tags/Docker/"/>
    
      <category term="K8s" scheme="http://suqun.github.io/tags/K8s/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[åŸºäºDockerçš„javaå¾®æœåŠ¡(ä¸€) éƒ¨ç½²Chris Richardsonçš„è½¬è´¦æ¡ˆä¾‹]]></title>
    <link href="http://suqun.github.io/2016/08/24/dockerjavamicroservice1/"/>
    <id>http://suqun.github.io/2016/08/24/dockerjavamicroservice1/</id>
    <published>2016-08-24T11:23:15.000Z</published>
    <updated>2016-10-24T15:24:15.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u6982_u8FF0"><a href="#u6982_u8FF0" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>æœ¬æ–‡ä¸»è¦å‚è€ƒ<a href="http://www.infoq.com/cn/articles/Automate-Docker-Cloud-Java-Microservice-Deployment-with-DCHQ" target="_blank" rel="external">ä½¿ç”¨DCHQè‡ªåŠ¨éƒ¨ç½²å’Œç®¡ç†åŸºäºDockerçš„äº‘/è™šæ‹ŸåŒ–ç¯å¢ƒJavaå¾®æœåŠ¡</a></p>
<p>æœ€è¿‘åœ¨å­¦ä¹ å¾®æœåŠ¡,å‰ä¸¤å‘¨äº†è§£åŸºäºSpring Cloudçš„å¾®æœåŠ¡æ¡†æ¶,è¿™ä¸¤å¤©å¼€å§‹çœ‹çœ‹å…³äºDockerçš„å¾®æœåŠ¡ã€‚</p>
<p>Spring Cloudæ•´åˆäº†Netflixå¼€æºçš„Eureka,Hystrix,Ribbon,Feign,ZUULç­‰,<br>æ˜¯ä¸€ä¸ªåŸºäºSpring Bootå®ç°çš„äº‘åº”ç”¨å¼€å‘å·¥å…·ï¼Œå®ƒä¸ºåŸºäºJVMçš„äº‘åº”ç”¨å¼€å‘ä¸­çš„é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€å¾®ä»£ç†ã€æ§åˆ¶æ€»çº¿ã€å…¨å±€é”ã€å†³ç­–ç«é€‰ã€<br>åˆ†å¸ƒå¼ä¼šè¯å’Œé›†ç¾¤çŠ¶æ€ç®¡ç†ç­‰æ“ä½œæä¾›äº†ä¸€ç§ç®€å•çš„å¼€å‘æ–¹å¼(<a href="http://blog.didispace.com/springcloud1/" target="_blank" rel="external">å‚è€ƒDIDI</a>)ã€‚</p>
<p>é‚£ä¹ˆDockerçš„å¾®æœåŠ¡æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ã€‚æœ‰ç©ºçš„åŒå­¦å¯ä»¥çœ‹çœ‹Spring Cloudå’ŒDockerçš„æ¯”è¾ƒ<br><a href="http://www.infoq.com/cn/articles/netflix-oss-spring-cloud-kubernetes?utm_campaign=rightbar_v2&amp;utm_source=infoq&amp;utm_medium=articles_link&amp;utm_content=link_text" target="_blank" rel="external">Netflix OSSã€Spring Cloudè¿˜æ˜¯Kubernetes?</a>ã€‚<br>ç®€å•çš„è¯´,å°±æ˜¯åŸºäºDockerçš„è°ƒåº¦å™¨Kuberneteså¯ä»¥å¸®å¿™æŠŠå¤§å®¶ä»æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰åŠŸèƒ½ä¸­è§£æ”¾å‡ºæ¥,æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å¼€å‘ã€‚</p>
<p>Kubernetesæ˜¯ä¸ªä»€ä¹ˆé¬¼?è¦äº†è§£å®ƒ,æˆ‘ä»¬å¾—å…ˆäº†è§£ä¸‹,æˆ‘ä»¬å¼€å‘å¥½çš„é¡¹ç›®æ˜¯æ€ä¹ˆåœ¨Dockerä¸Šéƒ¨ç½²åº”ç”¨çš„,å¤šä¸ªDockerå®¹å™¨åˆæ˜¯å¦‚ä½•ç®¡ç†çš„ã€‚<br>è¿™ç¯‡æ–‡ç« æ˜¯Chris Richardsoné’ˆå¯¹äº‹ä»¶æº¯æºã€CQRSå’ŒDockeræ‰€åˆ›å»ºçš„è½¬è´¦<a href="https://github.com/cer/event-sourcing-examples" target="_blank" rel="external">æ¡ˆä¾‹</a>ã€‚</p>
<p>æ¡ˆä¾‹ä¸»è¦åŠŸèƒ½å¦‚ä¸‹:</p>
<ul>
<li>åŸºäºä¸€ä¸ªåˆå§‹çš„ä½™é¢ï¼Œåˆ›å»ºæ–°è´¦æˆ·</li>
<li>æŸ¥è¯¢æŸä¸ªè´¦æˆ·ï¼Œå¾—åˆ°å…¶ä½™é¢</li>
<li>ä»ä¸€ä¸ªè´¦æˆ·åˆ°å¦ä¸€ä¸ªè´¦æˆ·è¿›è¡Œè½¬è´¦</li>
</ul>
<p>æˆ‘ä»¬å°±ç”¨è¿™ä¸ªä¾‹å­,æ¥äº†è§£ä¸‹æ•´ä¸ªå¼€å‘éƒ¨ç½²æµç¨‹(<strong>ä»…ä»…æ˜¯äº†è§£</strong>)ã€‚æ¡ˆä¾‹çš„å…·ä½“ä¸šåŠ¡é€»è¾‘ä»‹ç»è¯·ç§»æ­¥<a href="https://github.com/cer/event-sourcing-examples" target="_blank" rel="external">event-sourcing-examples</a></p>
<h3 id="u83B7_u53D6Event_Store_u51ED_u8BC1"><a href="#u83B7_u53D6Event_Store_u51ED_u8BC1" class="headerlink" title="è·å–Event Storeå‡­è¯"></a>è·å–Event Storeå‡­è¯</h3><p>æ¶æ„ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æ–¹å¼æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§,è¿™é‡Œé¢ä½¿ç”¨çš„æ˜¯Event Storeã€‚</p>
<p>åœ¨ä½¿ç”¨ä¹‹å‰,éœ€è¦è·å–Event Storeå‡­è¯ã€‚<br>è¿›å…¥<a href="http://eventuate.io/" target="_blank" rel="external">Event Store</a>å®˜ç½‘,æ³¨å†Œä¸ªè´¦å·,è¿‡å‡ ä¸ªå°æ—¶ä¸€èˆ¬å°±ä¼šæ”¶åˆ°æ¥è‡ª<a href="/chris@chrisrichardson.net">chris</a>çš„é‚®ä»¶ã€‚<br>é‚®ä»¶ä¸­æœ‰EVENTUATE_API_KEY_IDå’ŒEVENTUATE_API_KEY_SECRET,è¿™ä¸ªåœ¨åé¢çš„ymlæ¨¡æ¿é‡Œä¼šç”¨åˆ°ã€‚</p>
<h3 id="gradle_u6784_u5EFA"><a href="#gradle_u6784_u5EFA" class="headerlink" title="gradleæ„å»º"></a>gradleæ„å»º</h3><p>ä»<a href="https://github.com/cer/event-sourcing-examples" target="_blank" rel="external">event-sourcing-examples</a>cloneé¡¹ç›®åˆ°æœ¬åœ°ã€‚</p>
<p>ç›´æ¥ä¸‹è½½ä¸‹æ¥çš„ä¾‹å­ï¼Œéƒ¨ç½²æµ‹è¯•çš„æ—¶å€™ï¼Œä¼šæŠ¥å‡ ä¸ªé”™è¯¯ï¼Œéœ€è¦å¯¹ä»£ç åšéƒ¨åˆ†ä¿®æ”¹</p>
<ul>
<li>ä¿®æ”¹ xx-xx-side-serviceæ¨¡å—ä¸­build.gradleæ–‡ä»¶,æ·»åŠ å¦‚ä¸‹å†…å®¹<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jar &#123;</span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes <span class="string">'Main-Class'</span>: <span class="string">'net.chrisrichardson.eventstore.javaexamples.banking.web.main.XxxxSideServiceMain'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æ·»åŠ è¿™ä¸ªè§£å†³éƒ¨ç½²æ—¶é‡åˆ°çš„æ‰¾ä¸åˆ°manifesté”™è¯¯</p>
<ul>
<li>xx-xx-side-serviceä¸»æ–¹æ³•æ·»åŠ æ³¨è§£@SpringBootApplication</li>
</ul>
<p>ä¸»æ–¹æ³•æ²¡æœ‰@SpringBootApplicationè¿™ä¸ªæ³¨è§£ï¼Œæ˜¯æ— æ³•å¯åŠ¨spring bootæ»´ã€‚</p>
<p>ä¿®æ”¹åï¼Œä½¿ç”¨gradleçš„assembleå‘½ä»¤æ„å»ºï¼Œæ„å»ºæˆåŠŸåï¼Œæ¨¡å—çš„/build/libsä¼šç”ŸæˆjaråŒ…ã€‚</p>
<h3 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h3><p>gradleæ„å»ºå®Œæ¯•åï¼Œæˆ‘ä»¬è¦æŠŠserviceæ¨¡å—çš„jaråŒ…æ”¾åˆ°ä¸€ä¸ªdockeré•œåƒä¸­ï¼Œç„¶åå¯åŠ¨è¿™ä¸ªdockerã€‚<br>è¿™é‡Œä½¿ç”¨äº†docker-composeæ¥ç”Ÿæˆå¯åŠ¨é•œåƒã€‚</p>
<p>docker-composeçš„å®‰è£…åŠä»‹ç»ï¼Œè¯·ç§»æ­¥ï¼š<a href="https://yeasy.gitbooks.io/docker_practice/content/compose/" target="_blank" rel="external">Docker Compose é¡¹ç›®</a></p>
<h4 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h4><p>docker-composeç®¡ç†è°ƒåº¦dockerå®¹å™¨é»˜è®¤æ˜¯æ ¹æ®docker-compose.ymlæ¨¡æ¿è¿›è¡Œçš„ã€‚è¿™ä¸ªæ¨¡æ¿é‡Œå®šä¹‰äº†ç”Ÿæˆé•œåƒéƒ¨ç½²é•œåƒçš„ä¸€äº›æ­¥éª¤ã€‚</p>
<p>æœ¬æ¡ˆä¾‹çš„ymlå¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accountscommandside:&#10;  image: openjdk:8u92-jdk-alpine&#10;  working_dir: /app&#10;  volumes:&#10;    - ./accounts-command-side-service/build/libs:/app&#10;  command: java -jar /app/accounts-command-side-service.jar&#10;  ports:&#10;    - &#34;8080:8080&#34;&#10;  environment:&#10;    EVENTUATE_API_KEY_ID: 5NJSVTRJ6UTYVL8U4RN8TKDRM&#10;    EVENTUATE_API_KEY_SECRET: fiAKWYEEj7EVxNi6yKXF8WDcVLbYA8Cu5RnFFKjwVOw&#10;&#10;transactionscommandside:&#10;  image: openjdk:8u92-jdk-alpine&#10;  working_dir: /app&#10;  volumes:&#10;    - ./transactions-command-side-service/build/libs:/app&#10;  command: java -jar /app/transactions-command-side-service.jar&#10;  ports:&#10;    - &#34;8082:8080&#34;&#10;  environment:&#10;    EVENTUATE_API_KEY_ID: 5NJSVTRJ6UTYVL8U4RN8TKDRM&#10;    EVENTUATE_API_KEY_SECRET: fiAKWYEEj7EVxNi6yKXF8WDcVLbYA8Cu5RnFFKjwVOw&#10;&#10;&#10;accountsqueryside:&#10;  image: openjdk:8u92-jdk-alpine&#10;  working_dir: /app&#10;  volumes:&#10;    - ./accounts-query-side-service/build/libs:/app&#10;  command: java -jar /app/accounts-query-side-service.jar&#10;  ports:&#10;    - &#34;8081:8080&#34;&#10;  links:&#10;    - mongodb&#10;  environment:&#10;    EVENTUATE_API_KEY_ID: 5NJSVTRJ6UTYVL8U4RN8TKDRM&#10;    EVENTUATE_API_KEY_SECRET: fiAKWYEEj7EVxNi6yKXF8WDcVLbYA8Cu5RnFFKjwVOw&#10;    SPRING_DATA_MONGODB_URI: mongodb://mongodb/mydb&#10;&#10;mongodb:&#10;  image: mongo:3.2.9&#10;  hostname: mongodb&#10;  command: mongod --smallfiles&#10;  ports:&#10;    - &#34;27017:27017&#34;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé¢å®šä¹‰äº†4ä¸ªå®¹å™¨å†…å®¹ï¼Œåˆ†åˆ«æ˜¯accountscommandsideï¼Œtransactionscommandsideï¼Œaccountsquerysideï¼Œmongodb</p>
<ul>
<li>imageï¼šæŒ‡å®šä¸ºé•œåƒåç§°æˆ–é•œåƒ IDã€‚å¦‚æœé•œåƒåœ¨æœ¬åœ°ä¸å­˜åœ¨ï¼ŒCompose å°†ä¼šå°è¯•æ‹‰å–è¿™ä¸ªé•œåƒ</li>
<li>volumesï¼šå·æŒ‚è½½è·¯å¾„è®¾ç½®ï¼Œè¿™é‡Œæ˜¯å°†å®¹å™¨çš„/appè·¯å¾„æŒ‚è½½åˆ°å®¿ä¸»æœº/build/libs è·¯å¾„ä¸Š</li>
<li>commandï¼šè¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ï¼Œè¿™é‡Œæ˜¯é»˜è®¤ç›´æ¥å¯åŠ¨spring booté¡¹ç›®</li>
<li>portsï¼šæš´éœ²ç«¯å£ä¿¡æ¯ï¼Œæ ¼å¼å¦‚ä¸‹<ul>
<li>å®¿ä¸»ï¼šå®¹å™¨ ï¼ˆHOST:CONTAINERï¼‰</li>
<li>å®¹å™¨ï¼ˆå®¿ä¸»ä¼šéšæœºé€‰æ‹©ç«¯å£ï¼‰</li>
</ul>
</li>
<li>linksï¼šé“¾æ¥åˆ°å…¶å®ƒæœåŠ¡ä¸­çš„å®¹å™¨ã€‚ä½¿ç”¨æœåŠ¡åç§°ï¼ˆåŒæ—¶ä½œä¸ºåˆ«åï¼‰æˆ–æœåŠ¡åç§°ï¼šæœåŠ¡åˆ«å ï¼ˆSERVICE:ALIASï¼‰æ ¼å¼éƒ½å¯ä»¥ã€‚ <ul>
<li>db</li>
<li>db:database</li>
<li>redis</li>
</ul>
</li>
<li>environmentï¼šè®¾ç½®ç¯å¢ƒå˜é‡</li>
</ul>
<p>æ›¿æ¢æˆä½ è‡ªå·±çš„EVENTUATE_API_KEY_IDå’ŒEVENTUATE_API_KEY_SECRETï¼Œå¦åˆ™éƒ¨ç½²åè¿è¡Œæµ‹è¯•ï¼Œä¼šæŠ¥401æœªæˆæƒé”™è¯¯ã€‚</p>
<h4 id="docker-compse_up"><a href="#docker-compse_up" class="headerlink" title="docker-compse up"></a>docker-compse up</h4><p>è®¾ç½®å¥½ymlæ¨¡æ¿ä»¥åï¼Œä½¿ç”¨docker-compse upæ¥å¯åŠ¨è¿™4ä¸ªå®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ  java-spring git:(master) âœ— docker-compose up</span><br></pre></td></tr></table></figure>
<p>å†å¼€ä¸ªshellï¼Œçœ‹ä¸‹å¯åŠ¨çš„å››ä¸ªå®¹å™¨çš„çŠ¶æ€</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">âœ  java-spring git:(master) âœ— docker-compose ps</span><br><span class="line">                Name                              Command               State            Ports</span><br><span class="line">--------------------------------------------------------------------------------------------------------</span><br><span class="line">javaspring_accountscommandside_1       java -jar /app/accounts-co ...   Up      <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8080</span>-&gt;<span class="number">8080</span>/tcp</span><br><span class="line">javaspring_accountsqueryside_1         java -jar /app/accounts-qu ...   Up      <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8081</span>-&gt;<span class="number">8080</span>/tcp</span><br><span class="line">javaspring_mongodb_1                   /entrypoint.sh mongod --sm ...   Up      <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">27017</span>-&gt;<span class="number">27017</span>/tcp</span><br><span class="line">javaspring_transactionscommandside_1   java -jar /app/transaction ...   Up      <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8082</span>-&gt;<span class="number">8080</span>/tcp</span><br></pre></td></tr></table></figure>
<p>å››ä¸ªçŠ¶æ€éƒ½æ˜¯upï¼Œå¥½äº†ï¼Œè®¿é—®æœåŠ¡æµ‹è¯•ä¸‹ã€‚</p>
<h3 id="u6D4B_u8BD5"><a href="#u6D4B_u8BD5" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å…ˆåˆ›å»º2ä¸ªè´¦æˆ·ï¼Œæ¯ä¸ªéƒ½åˆå§‹500ç¾å…ƒ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  java-spring git:(master) âœ— curl -X POST -H <span class="string">"Content-Type: application/json"</span> -H <span class="string">"Cache-Control: no-cache"</span> <span class="operator">-d</span> <span class="string">'&#123;"initialBalance": 500&#125;'</span> <span class="string">"http://localhost:8080/accounts"</span></span><br><span class="line">&#123;<span class="string">"accountId"</span>:<span class="string">"00000156bfc1c044-0242ac1100460000"</span>&#125;%                                                                            </span><br><span class="line">âœ  java-spring git:(master) âœ— curl -X POST -H <span class="string">"Content-Type: application/json"</span> -H <span class="string">"Cache-Control: no-cache"</span> <span class="operator">-d</span> <span class="string">'&#123;"initialBalance": 500&#125;'</span> <span class="string">"http://localhost:8080/accounts"</span></span><br><span class="line">&#123;<span class="string">"accountId"</span>:<span class="string">"00000156bfc1da88-0242ac1100960000"</span>&#125;%</span><br></pre></td></tr></table></figure></p>
<p>æ ¹æ®è´¦æˆ·IDæŸ¥è¯¢<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  java-spring git:(master) âœ— curl -X GET <span class="string">"http://localhost:8081/accounts/00000156bfc1c044-0242ac1100460000"</span></span><br><span class="line">&#123;<span class="string">"accountId"</span>:<span class="string">"00000156bfc1c044-0242ac1100460000"</span>,<span class="string">"balance"</span>:<span class="number">50000</span>&#125;%                                                        </span><br><span class="line">âœ  java-spring git:(master) âœ— curl -X GET <span class="string">"http://localhost:8081/accounts/00000156bfc1da88-0242ac1100960000"</span></span><br><span class="line">&#123;<span class="string">"accountId"</span>:<span class="string">"00000156bfc1da88-0242ac1100960000"</span>,<span class="string">"balance"</span>:<span class="number">50000</span>&#125;%</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°æ¯ä¸ªè´¦æˆ·é‡Œéƒ½æœ‰50000ç¾åˆ†ã€‚è¯•è¯•è½¬è´¦ï¼Œç„¶åå†æŸ¥è¯¢<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">âœ  java-spring git:(master) âœ— curl -X POST -H <span class="string">"Content-Type: application/json"</span> <span class="operator">-d</span> <span class="string">'&#123;"fromAccountId" : "00000156bfc1c044-0242ac1100460000", "toAccountId" : "00000156bfc1da88-0242ac1100960000", "amount" : 500&#125;'</span> <span class="string">"http://localhost:8082/transfers"</span></span><br><span class="line">&#123;<span class="string">"moneyTransferId"</span>:<span class="string">"00000156bfc75387-0242ac1100ac0000"</span>&#125;%                                                                                                                                                    </span><br><span class="line">âœ  java-spring git:(master) âœ— curl -X GET <span class="string">"http://localhost:8081/accounts/00000156bfc1da88-0242ac1100960000"</span></span><br><span class="line">&#123;<span class="string">"accountId"</span>:<span class="string">"00000156bfc1da88-0242ac1100960000"</span>,<span class="string">"balance"</span>:<span class="number">50000</span>&#125;%                                                                                                                                          </span><br><span class="line">âœ  java-spring git:(master) âœ— curl -X GET <span class="string">"http://localhost:8081/accounts/00000156bfc1c044-0242ac1100460000"</span></span><br><span class="line">&#123;<span class="string">"accountId"</span>:<span class="string">"00000156bfc1c044-0242ac1100460000"</span>,<span class="string">"balance"</span>:<span class="number">0</span>&#125;%                                                                                                                                              </span><br><span class="line">âœ  java-spring git:(master) âœ— curl -X GET <span class="string">"http://localhost:8081/accounts/00000156bfc1da88-0242ac1100960000"</span></span><br><span class="line">&#123;<span class="string">"accountId"</span>:<span class="string">"00000156bfc1da88-0242ac1100960000"</span>,<span class="string">"balance"</span>:<span class="number">100000</span>&#125;%</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ä¸­é—´æœ‰ä¸ªçŠ¶æ€æ˜¯ä¸å¯¹çš„ï¼Œè¿™ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼Œè¿˜æ²¡æœ‰è‡ªå·±çœ‹ï¼Œåº”è¯¥æ˜¯æœ‰å»¶è¿Ÿï¼Œåæ¥å†æŸ¥è¯¢å°±æ˜¯å‡†ç¡®çš„äº†ã€‚äº‹ä»¶é©±åŠ¨çš„åé¢ä¼šä¸“é—¨çœ‹çœ‹å†æ•´ç†ç¯‡æ–‡ç« ã€‚</p>
<h3 id="u7ED3_u8BED"><a href="#u7ED3_u8BED" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>æœ¬ç¯‡ä¸»è¦æè¿°äº†å¦‚ä½•ä½¿ç”¨docker-composeæ„å»ºåŸºäºdockerçš„javaå¾®æœåŠ¡æ¡†æ¶ã€‚åç»­ä¼šå¯¹é‡Œé¢çš„çŸ¥è¯†ç‚¹åšäº›è¯¦ç»†çš„å­¦ä¹ ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u6982_u8FF0"><a href="#u6982_u8FF0" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>æœ¬æ–‡ä¸»è¦å‚è€ƒ<a href="http://www.infoq.com/cn/articles/Auto]]>
    </summary>
    
      <category term="CQRS" scheme="http://suqun.github.io/tags/CQRS/"/>
    
      <category term="Docker" scheme="http://suqun.github.io/tags/Docker/"/>
    
      <category term="Event-Sourcing" scheme="http://suqun.github.io/tags/Event-Sourcing/"/>
    
      <category term="Spring Boot" scheme="http://suqun.github.io/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Spring Cloudæ„å»ºå¾®æœåŠ¡æ¶æ„ï¼ˆå…­ï¼‰æœåŠ¡ç½‘å…³]]></title>
    <link href="http://suqun.github.io/2016/08/09/springcloud6/"/>
    <id>http://suqun.github.io/2016/08/09/springcloud6/</id>
    <published>2016-08-09T07:47:33.000Z</published>
    <updated>2016-10-24T15:31:50.000Z</updated>
    <content type="html"><![CDATA[<p>åŸæ–‡ : <a href="http://blog.didispace.com/springcloud5/" target="_blank" rel="external">Spring Cloudæ„å»ºå¾®æœåŠ¡æ¶æ„ï¼ˆäº”ï¼‰æœåŠ¡ç½‘å…³</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>åŸæ–‡ : <a href="http://blog.didispace.com/springcloud5/" target="_blank" rel="external">Spring Cloudæ„å»ºå¾®æœåŠ¡æ¶æ„ï¼ˆäº”ï¼‰æœåŠ¡ç½‘å…³</a></p>
]]>
    </summary>
    
      <category term="Spring Boot" scheme="http://suqun.github.io/tags/Spring-Boot/"/>
    
      <category term="Spring Cloud" scheme="http://suqun.github.io/tags/Spring-Cloud/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Spring Cloudæ„å»ºå¾®æœåŠ¡æ¶æ„ï¼ˆäº”ï¼‰åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ]]></title>
    <link href="http://suqun.github.io/2016/08/09/SpringCloud5/"/>
    <id>http://suqun.github.io/2016/08/09/SpringCloud5/</id>
    <published>2016-08-09T02:38:46.000Z</published>
    <updated>2016-10-24T15:31:50.000Z</updated>
    <content type="html"><![CDATA[<p>åŸæ–‡ : <a href="http://blog.didispace.com/springcloud4/" target="_blank" rel="external">Spring Cloudæ„å»ºå¾®æœåŠ¡æ¶æ„ï¼ˆå››ï¼‰åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>åŸæ–‡ : <a href="http://blog.didispace.com/springcloud4/" target="_blank" rel="external">Spring Cloudæ„å»ºå¾®æœåŠ¡æ¶æ„ï¼ˆå››ï¼‰åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</a></p>
]]>
    </summary>
    
      <category term="Spring Boot" scheme="http://suqun.github.io/tags/Spring-Boot/"/>
    
      <category term="Spring Cloud" scheme="http://suqun.github.io/tags/Spring-Cloud/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Spring Cloudæ„å»ºå¾®æœåŠ¡æ¶æ„ï¼ˆå››ï¼‰é›†ç¾¤]]></title>
    <link href="http://suqun.github.io/2016/08/05/Spring-Cloud%E6%9E%84%E5%BB%BA%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%88%E5%9B%9B%EF%BC%89%E9%9B%86%E7%BE%A4/"/>
    <id>http://suqun.github.io/2016/08/05/Spring-Cloudæ„å»ºå¾®æœåŠ¡æ¶æ„ï¼ˆå››ï¼‰é›†ç¾¤/</id>
    <published>2016-08-05T02:07:59.000Z</published>
    <updated>2016-10-24T15:30:37.000Z</updated>
    <content type="html"><![CDATA[<p>å‰é¢ä¸‰ç¯‡éƒ½åˆ†äº«è‡ª<a href="http://blog.didispace.com/" target="_blank" rel="external">ç¨‹åºçŒ¿DD</a>çš„åšå®¢,æš‚æ—¶(2016å¹´08æœˆ05æ—¥)è¿˜æ²¡æœ‰æ›´æ–°å…³äºEurekaé›†ç¾¤çš„åšå®¢ã€‚<br>è¿™é‡Œå‚è€ƒäº†<a href="https://segmentfault.com/blog/mumubin" target="_blank" rel="external">æœ¨æœ¨å½¬</a>çš„<a href="https://segmentfault.com/a/1190000006149891" target="_blank" rel="external">Spring Cloudå®æˆ˜(äºŒ)-Spring Cloud Eureka</a>åšå®¢å†…å®¹ã€‚<br>å¯¹é›†ç¾¤é…ç½®ç®€å•è®°å½•ä¸‹,æ–¹ä¾¿ä»¥åæŸ¥é˜…ã€‚åŒæ—¶ä¹ŸæœŸå¾…<code>ç¨‹åºçŒ¿DD</code>æ›´æ–°æ›´å¤šæ›´ç²¾å½©çš„åšå®¢ã€‚</p>
<p>æœ¬æ–‡ä»£ç åŸºäº<a href="https://git.oschina.net/didispace/SpringBoot-Learning/tree/master/Chapter9-1-3?dir=1&amp;filepath=Chapter9-1-3&amp;oid=cc93af44af30b42320041332790d071ed72a2450&amp;sha=4329c564d673b6cf7a53893ad9770abb7a67b328" target="_blank" rel="external">ç¨‹åºçŒ¿DD / SpringBoot-Learning / Chapter9-1-3</a>è¿›è¡Œé›†ç¾¤é…ç½®ã€‚</p>
<p>Spring Cloud å®˜æ–¹æ–‡æ¡£ä¸Šå¯¹é›†ç¾¤é…ç½®ä»‹ç»çš„éå¸¸ç®€å•ï¼Œå¯¹Eureka Serverè¿›è¡Œ<a href="http://cloud.spring.io/spring-cloud-static/docs/1.0.x/spring-cloud.html#_peer_awareness" target="_blank" rel="external">Peer Awareness</a>é…ç½®ï¼Œè¿™æ ·å¤šä¸ªæœåŠ¡ç«¯å°±å¯ä»¥å…³è”åˆ°ä¸€èµ·ã€‚å¥½äº†ï¼Œä¸‹é¢çœ‹çœ‹å…·ä½“çš„é…ç½®ã€‚</p>
<h4 id="hosts_u4FEE_u6539"><a href="#hosts_u4FEE_u6539" class="headerlink" title="hostsä¿®æ”¹"></a>hostsä¿®æ”¹</h4><p>åœ¨hostsï¼ˆè·¯å¾„ï¼š/etc/hostsï¼‰æ–‡ä»¶ä¸­æ·»åŠ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1       eureka-primary&#10;127.0.0.1       eureka-secondary&#10;127.0.0.1       eureka-tertiary</span><br></pre></td></tr></table></figure>
<h4 id="u670D_u52A1_u7AEF_u914D_u7F6E"><a href="#u670D_u52A1_u7AEF_u914D_u7F6E" class="headerlink" title="æœåŠ¡ç«¯é…ç½®"></a>æœåŠ¡ç«¯é…ç½®</h4><p>å…ˆæ³¨é‡Šæ‰application.propertiesä¸­çš„é…ç½®ï¼Œæ·»åŠ application.ymlï¼Œåœ¨ymlæ·»åŠ å¤šä¸ªprofiles,å’ŒinstanceIdï¼Œæ­¤æ—¶Eureka Server åŒæ—¶ä¹Ÿæ˜¯ä¸ªEureka Client,éœ€è¦è®¾ç½®eureka.client.serviceUrl.defaultZone,å€¼æ˜¯å¦å¤–ä¸¤ä¸ªï¼ˆè¿™å°±æ˜¯å®˜ç½‘æ‰€è¯´çš„<code>Peer Awareness</code>ï¼‰:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---&#10;spring:&#10;  application:&#10;    name: eureka-server-clustered&#10;  profiles: primary&#10;server:&#10;  port: 1111&#10;eureka:&#10;  instance:&#10;    hostname: eureka-primary&#10;  client:&#10;    registerWithEureka: true&#10;    fetchRegistry: true&#10;    serviceUrl:&#10;      defaultZone: http://eureka-secondary:1112/eureka/,http://eureka-tertiary:1113/eureka/&#10;---&#10;spring:&#10;  application:&#10;    name: eureka-server-clustered&#10;  profiles: secondary&#10;server:&#10;  port: 1112&#10;eureka:&#10;  instance:&#10;    hostname: eureka-secondary&#10;  client:&#10;    registerWithEureka: true&#10;    fetchRegistry: true&#10;    serviceUrl:&#10;      defaultZone: http://eureka-secondary:1111/eureka/,http://eureka-tertiary:1113/eureka/&#10;---&#10;spring:&#10;  application:&#10;    name: eureka-server-clustered&#10;  profiles: tertiary&#10;server:&#10;  port: 1113&#10;eureka:&#10;  instance:&#10;    hostname: eureka-tertiary&#10;  client:&#10;    registerWithEureka: true&#10;    fetchRegistry: true&#10;    serviceUrl:&#10;      defaultZone: http://eureka-secondary:1111/eureka/,http://eureka-tertiary:1112/eureka/</span><br></pre></td></tr></table></figure>
<h4 id="u670D_u52A1_u7AEF_u542F_u52A8"><a href="#u670D_u52A1_u7AEF_u542F_u52A8" class="headerlink" title="æœåŠ¡ç«¯å¯åŠ¨"></a>æœåŠ¡ç«¯å¯åŠ¨</h4><p>é…ç½®å®Œæˆï¼Œè¦åˆ†åˆ«å¯åŠ¨3ä¸ªServerï¼Œåˆ†åˆ«æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ  eureka-server git:(master) âœ— mvn clean &amp;&amp; mvn install</span><br><span class="line">âœ  eureka-server git:(master) âœ— <span class="built_in">cd</span> target</span><br><span class="line">âœ  target git:(master) âœ— java -Dspring.profiles.active=primary -jar eureka-server-<span class="number">0.0</span>.<span class="number">1</span>-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ  target git:(master) âœ— java -Dspring.profiles.active=secondary -jar eureka-server-<span class="number">0.0</span>.<span class="number">1</span>-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ  target git:(master) âœ— java -Dspring.profiles.active=tertiary -jar eureka-server-<span class="number">0.0</span>.<span class="number">1</span>-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è®¿é—®å…¶ä¸­ä¸€ä¸ªæœåŠ¡åœ°å€<a href="http://localhost:1111/" target="_blank" rel="external">http://localhost:1111/</a> å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼Œè¯´æ˜æœåŠ¡å¯åŠ¨æˆåŠŸï¼š</p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/eureka-server-1.png" alt="Eureka Server"></p>
<h4 id="u5BA2_u6237_u7AEF_u914D_u7F6E"><a href="#u5BA2_u6237_u7AEF_u914D_u7F6E" class="headerlink" title="å®¢æˆ·ç«¯é…ç½®"></a>å®¢æˆ·ç«¯é…ç½®</h4><p>æœåŠ¡ç«¯å·²å‡†å¤‡å°±ç»ªï¼Œå®¢æˆ·ç«¯å¦‚ä½•æ³¨å†Œåˆ°å¤šä¸ªæœåŠ¡åœ°å€å‘¢ï¼Ÿå…¶å®åœ¨æœåŠ¡ç«¯é…ç½®defaultZoneæ—¶ï¼ŒæŒ‡å®šå¤šä¸ªåœ°å€ï¼Œå°±å‘Šè¯‰æˆ‘ä»¬å®¢æˆ·ç«¯ä¹Ÿè¿™ä¹ˆæŒ‡å®šå°±å¯ä»¥å•¦ã€‚</p>
<p>ä¿®æ”¹compute-serviceçš„application.propertiesä¸­çš„defaultZoneå€¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#25351;&#23450;&#24494;&#26381;&#21153;&#30340;&#21517;&#31216;&#21518;&#32493;&#22312;&#35843;&#29992;&#30340;&#26102;&#20505;&#21482;&#38656;&#35201;&#20351;&#29992;&#35813;&#21517;&#31216;&#23601;&#21487;&#20197;&#36827;&#34892;&#26381;&#21153;&#30340;&#35775;&#38382;&#10;spring.application.name=compute-service&#10;#&#24212;&#29992;&#31471;&#21475;&#10;server.port=2222&#10;#&#25351;&#23450;&#26381;&#21153;&#27880;&#20876;&#20013;&#24515;&#30340;&#20301;&#32622;&#10;#eureka.client.serviceUrl.defaultZone=http://localhost:1111/eureka/&#10;eureka.client.serviceUrl.defaultZone=http://eureka-primary:1111/eureka/,http://eureka-secondary:1112/eureka/,http://eureka-tertiary:1113/eureka/</span><br></pre></td></tr></table></figure>
<h4 id="u542F_u52A8_u5BA2_u6237_u7AEF"><a href="#u542F_u52A8_u5BA2_u6237_u7AEF" class="headerlink" title="å¯åŠ¨å®¢æˆ·ç«¯"></a>å¯åŠ¨å®¢æˆ·ç«¯</h4><p>å®¢æˆ·ç«¯é»˜è®¤ç«¯å£æ˜¯2222ï¼Œæˆ‘ä»¬å¯åŠ¨2ä¸ªå®¢æˆ·ç«¯ï¼Œå¦ä¸€ä¸ªç«¯å£ç”¨2223å¥½äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ  compute-service git:(master) âœ— mvn clean &amp;&amp; mvn insatll</span><br><span class="line">âœ  compute-service git:(master) âœ— <span class="built_in">cd</span> target</span><br><span class="line">âœ  target git:(master) âœ— java -jar compute-service-<span class="number">0.0</span>.<span class="number">1</span>-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ  target git:(master) âœ— java -DServer.port=<span class="number">2223</span> -jar compute-service-<span class="number">0.0</span>.<span class="number">1</span>-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>
<p>é‡æ–°æŸ¥çœ‹ä¸‹<a href="http://localhost:1111/" target="_blank" rel="external">http://localhost:1111/</a></p>
<p><img src="http://7xpk5e.com1.z0.glb.clouddn.com/eureka-server-2.png" alt="client starting"></p>
<p>2ä¸ªå®¢æˆ·ç«¯å¯åŠ¨æˆåŠŸäº†ã€‚</p>
<h4 id="u6D4B_u8BD5"><a href="#u6D4B_u8BD5" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>å¯åŠ¨æ¶ˆè´¹è€…eureka-ribbonæˆåŠŸåï¼Œç®€å•æµ‹è¯•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ curl localhost:<span class="number">3333</span>/add</span><br><span class="line"><span class="number">30</span>%</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªå®¢æˆ·ç«¯ä¹Ÿæ‰“å‡ºäº†æ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">11</span>:<span class="number">18</span>:<span class="number">23.554</span>  INFO <span class="number">5127</span> --- [nio-<span class="number">2223</span>-exec-<span class="number">1</span>] com.ow.wises.web.ComputeController       : /add, host:<span class="number">192.168</span>.<span class="number">1.145</span>, service_id:compute-service, result:<span class="number">30</span></span><br></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œå°±å…ˆè¿™æ ·äº†ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>å‰é¢ä¸‰ç¯‡éƒ½åˆ†äº«è‡ª<a href="http://blog.didispace.com/" target="_blank" rel="external">ç¨‹åºçŒ¿DD</a>çš„åšå®¢,æš‚æ—¶(2016å¹´08æœˆ05æ—¥)è¿˜æ²¡æœ‰æ›´æ–°å…³äºEurekaé›†ç¾¤çš„åšå®¢ã€‚<br>è¿™é‡Œå‚è€ƒäº†<a hr]]>
    </summary>
    
      <category term="Eureka" scheme="http://suqun.github.io/tags/Eureka/"/>
    
      <category term="Netflix" scheme="http://suqun.github.io/tags/Netflix/"/>
    
      <category term="Ribbon" scheme="http://suqun.github.io/tags/Ribbon/"/>
    
      <category term="Spring Boot" scheme="http://suqun.github.io/tags/Spring-Boot/"/>
    
      <category term="Spring Cloud" scheme="http://suqun.github.io/tags/Spring-Cloud/"/>
    
  </entry>
  
</feed>
